2025-12-31T23:29:17.8436749Z ##[group]Run actions/github-script@v8
2025-12-31T23:29:17.8437364Z with:
2025-12-31T23:29:17.8445676Z   script: const outcome = process.env.GEMINI_OUTCOME;
const raw = process.env.GEMINI_RESULT || '';
const diagnostics = process.env.GEMINI_DIAGNOSTICS || 'No diagnostics available';

let decision = {
  merge: false,
  reason: outcome === 'success'
    ? `Gemini response missing. Diagnostics: ${diagnostics}`
    : `Gemini invocation failed. Diagnostics: ${diagnostics}`,
  risk: 'high'
};

if (outcome === 'success' && raw) {
  const jsonMatch = raw.match(/\{[\s\S]*\}/);
  if (jsonMatch) {
    try {
      const parsed = JSON.parse(jsonMatch[0]);
      decision.merge = parsed.merge === true;
      decision.reason = parsed.reason || `No reason provided. Diagnostics: ${diagnostics}`;
      decision.risk = parsed.risk || 'unknown';
    } catch (error) {
      decision.reason = `Unable to parse Gemini output: ${error.message}. Diagnostics: ${diagnostics}`;
    }
  } else {
    decision.reason = `Gemini output did not contain JSON. Diagnostics: ${diagnostics}`;
  }
}

core.setOutput('merge', decision.merge ? 'true' : 'false');
core.setOutput('reason', decision.reason);
core.setOutput('risk', decision.risk);
core.setOutput('truncated', process.env.PATCH_TRUNCATED === 'true' ? 'true' : 'false');
core.setOutput('patch_bytes', process.env.PATCH_BYTES || 'unknown');
core.setOutput('model', process.env.GEMINI_MODEL_USED || 'unspecified');
core.setOutput('diagnostics', process.env.GEMINI_DIAGNOSTICS || 'No diagnostics available');

2025-12-31T23:29:17.8455652Z   github-token: ***
2025-12-31T23:29:17.8456124Z   debug: false
2025-12-31T23:29:17.8456602Z   user-agent: actions/github-script
2025-12-31T23:29:17.8457186Z   result-encoding: json
2025-12-31T23:29:17.8457661Z   retries: 0
2025-12-31T23:29:17.8458120Z   retry-exempt-status-codes: 400,401,403,404,422
2025-12-31T23:29:17.8458713Z env:
2025-12-31T23:29:17.8459325Z   GEMINI_MODELS: ["gemini-2.5-pro","gemini-2.5-flash","gemini-2.5-flash-lite"]
2025-12-31T23:29:17.8460090Z   GEMINI_OUTCOME:
2025-12-31T23:29:17.8460538Z   GEMINI_RESULT:
2025-12-31T23:29:17.8460971Z   PATCH_TRUNCATED: false
2025-12-31T23:29:17.8461484Z   PATCH_BYTES: 25804
2025-12-31T23:29:17.8462111Z   GEMINI_MODEL_USED:
2025-12-31T23:29:17.8462563Z   GEMINI_DIAGNOSTICS:
2025-12-31T23:29:17.8463173Z ##[endgroup]
