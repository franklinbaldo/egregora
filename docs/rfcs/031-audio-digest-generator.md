# RFC 031: Audio Digest Generator (Quick Win)

**Status:** Proposed
**Author:** Jules (Visionary)
**Date:** 2026-01-26
**Relation to Moonshot:** This is the infrastructure layer for **RFC 030 (Egregora Symphony)**. It establishes the audio generation pipeline using a simpler "Summary -> Audio" workflow before tackling full dramatic re-enactment.

## ðŸ”­ Problem Statement

Users often have weeks or months of backlog in their Egregora archives. While the written summaries are helpful, they still require dedicated reading time. In a mobile-first world, people consume information while commuting, exercising, or doing choresâ€”contexts where reading is impossible.

Currently, Egregora's output is 100% visual. If you can't look at a screen, you can't access your memories.

## ðŸ’¡ Proposed Solution

We will implement an **Audio Digest Generator** as a standard post-processing step in the `write` pipeline.

1.  **Input:** The `summary` and `key_takeaways` generated by the `WriterAgent` for each post.
2.  **Process:** Send this text to a TTS provider (Local `piper` or API `OpenAI/ElevenLabs`).
3.  **Output:** An `.mp3` file embedded at the top of the blog post with a standard HTML5 audio player.
4.  **Feed:** (Optional) Generate a `podcast.xml` RSS feed so users can subscribe to their own life.

## ðŸ’Ž Value Proposition

*   **Time Saving:** Catch up on a week of chat in 5 minutes while driving.
*   **Accessibility:** Immediate value for visually impaired users.
*   **Engagement:** Increases the "surface area" of the archive.

## âœ… BDD Acceptance Criteria

```gherkin
Feature: Audio Digest Generation
  As a busy user
  I want a spoken summary of each blog post
  So that I can consume the content while multitasking

  Scenario: Successful Audio Generation
    Given a processed blog post "2023-12-25-Christmas.md" with a summary
    When the "audio_digest" pipeline step runs
    Then an MP3 file "2023-12-25-Christmas.mp3" should be created in "assets/audio/"
    And the generated HTML for the post should contain an <audio> tag pointing to this file

  Scenario: Graceful Failure on Missing TTS
    Given the TTS provider is unreachable or unconfigured
    When the "audio_digest" pipeline step runs
    Then the pipeline should NOT fail
    And a warning should be logged
    And the blog post should be generated without the audio player

  Scenario: Local Privacy Preference
    Given the configuration "audio.provider = 'local'"
    When the audio is generated
    Then no data should be sent to external APIs
    And the generation should happen on the local machine
```

## ðŸ“… Implementation Plan (30 Days)

*   **Week 1: Research & Prototype**
    *   Evaluate local TTS libraries (e.g., `piper-tts`, `coqui-ai/TTS`) for speed vs. quality.
    *   Prototype a standalone script `text_to_mp3.py`.
*   **Week 2: Integration**
    *   Create `src/egregora/output_sinks/audio/` module.
    *   Implement `AudioSink` class following the Output Sink protocol.
    *   Update `write.py` to trigger audio generation after post creation.
*   **Week 3: Frontend & Configuration**
    *   Update `src/egregora/rendering/templates/post.jinja` to include the audio player.
    *   Add `[audio]` section to configuration (provider, voice, speed).
*   **Week 4: Testing & Polish**
    *   Write unit tests for `AudioSink`.
    *   Verify offline behavior.
    *   Add documentation.

## ðŸ“Š Success Metrics

*   **Execution Time:** Audio generation adds < 30 seconds per post (using fast local models).
*   **Reliability:** 100% of posts have valid MP3s when feature is enabled.
*   **Adoption:** (If analytics existed) > 20% of users enable the feature.
