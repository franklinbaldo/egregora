# Issue #002: Configuration UX Issues

## Priority: High
## Effort: Medium
## Type: UX Enhancement

## Problem Description

The current configuration system creates friction for new users:

1. **Overwhelming Configuration**: `egregora.toml.example` has 87 lines with complex nested sections
2. **No Guided Setup**: Users must manually copy and edit configuration
3. **Poor Validation**: Generic Pydantic errors instead of helpful messages
4. **No Progressive Disclosure**: All options shown at once, regardless of user needs

**Current experience:**
```bash
cp egregora.toml.example egregora.toml  # Manual step
# Edit 87 lines of configuration
export GEMINI_API_KEY="..."  # Required but not obvious
uv run egregora  # May fail with cryptic errors
```

## Current Behavior

### Configuration File Issues
- 87-line configuration with 12 sections
- No clear indication of required vs optional settings
- Virtual group examples that don't work (reference non-existent groups)
- Mixed languages (Portuguese comments, English keys)

### Error Message Issues
```
Virtual group 'rc-americas': source 'rc-latam' not found
Virtual group 'tech-all': source 'tech-discussion' not found
# These errors shown even when user doesn't care about virtual groups
```

## Proposed Solution

### 1. Configuration Wizard

```bash
# Interactive setup for new users
uv run egregora init

Welcome to Egregora! Let's set up your configuration.

1. Where are your WhatsApp exports? [data/whatsapp_zips]: 
2. Where should posts be saved? [data]: 
3. Do you have a Gemini API key? [y/n]: n
   > No problem! You can run in demo mode or add it later.
4. Language for posts? [pt-BR/en-US]: en-US
5. Enable content enrichment? [y/n]: y
   > This analyzes shared links for better context.

Configuration saved to egregora.toml
Run: uv run egregora --demo-mode (to test without API key)
Run: uv run egregora --dry-run (to see what would be processed)
```

### 2. Minimal Default Configuration

Create a minimal `egregora.toml` by default:
```toml
# Essential configuration - generated by 'egregora init'
[directories]
zips_dir = "data/whatsapp_zips"
posts_dir = "data"

[pipeline]
post_language = "en-US"
model = "gemini-flash-lite-latest"

# Set your API key: export GEMINI_API_KEY="your-key-here"
# Or run in demo mode: egregora --demo-mode

# Advanced options in egregora-advanced.toml.example
```

### 3. Better Error Messages

Replace technical errors with actionable messages:

**Before:**
```
Virtual group 'rc-americas': source 'rc-latam' not found
```

**After:**
```
ðŸ’¡ Configuration tip: Virtual group 'rc-americas' references groups that don't exist.
   Remove this section or add the referenced groups to continue.
   
   File: egregora.toml, line 72
   
   Need help? Run: egregora config validate
```

### 4. Configuration Commands

```bash
# Validate configuration
uv run egregora config validate

# Show current configuration
uv run egregora config show

# Reset to defaults
uv run egregora config reset

# Add examples
uv run egregora config examples
```

### 5. Progressive Configuration

#### Basic Configuration (Auto-generated)
```toml
# Generated by: egregora init
[directories]
zips_dir = "data/whatsapp_zips"
posts_dir = "data"

[pipeline]
post_language = "en-US"
```

#### Advanced Configuration (Optional)
```toml
# Include advanced options
include = "egregora-advanced.toml"

# Or copy from: egregora-advanced.toml.example
```

## Implementation Details

### CLI Structure
```python
@click.group()
def config():
    """Configuration management commands."""
    pass

@config.command()
def init():
    """Interactive configuration setup."""
    # Guided wizard implementation

@config.command()
def validate():
    """Validate current configuration."""
    # Check for common issues

@config.command()
def show():
    """Display current configuration."""
    # Pretty-print config with sources
```

### Configuration Validation
```python
class ConfigValidator:
    def validate(self, config: PipelineConfig) -> List[ConfigIssue]:
        issues = []
        
        # Check for missing API key
        if not has_api_key() and not config.demo_mode:
            issues.append(ConfigIssue(
                level="warning",
                message="No GEMINI_API_KEY found. Run with --demo-mode or set API key.",
                fix="export GEMINI_API_KEY='your-key'"
            ))
        
        # Check virtual groups
        for name, merge in config.merges.items():
            missing = check_missing_sources(merge.source_groups)
            if missing:
                issues.append(ConfigIssue(
                    level="info", 
                    message=f"Virtual group '{name}' references missing groups: {missing}",
                    fix=f"Remove [merges.{name}] section or add referenced groups"
                ))
        
        return issues
```

## Expected Benefits

1. **Faster Onboarding**: New users can be productive in minutes
2. **Fewer Support Issues**: Clear error messages and validation
3. **Better Defaults**: Minimal configuration that works out of the box
4. **Progressive Complexity**: Start simple, add features as needed

## Acceptance Criteria

- [ ] `egregora init` command creates working minimal configuration
- [ ] Default configuration works without editing (in demo mode)
- [ ] Clear error messages with actionable suggestions
- [ ] Configuration validation with helpful output
- [ ] Documentation with configuration examples
- [ ] Migration guide for existing users

## Implementation Phases

### Phase 1: Core Commands
- Implement `egregora init` wizard
- Add `egregora config validate`
- Create minimal default templates

### Phase 2: Enhanced Validation
- Better error messages
- Configuration file suggestions
- Auto-fix common issues

### Phase 3: Advanced Features
- Configuration profiles
- Environment-specific configs
- Web-based configuration UI

## Files to Modify

- `src/egregora/__main__.py` - Add config subcommands
- `src/egregora/config.py` - Enhanced validation
- `templates/config/` - Configuration templates
- `egregora.toml.example` - Simplified example
- `docs/configuration.md` - Updated documentation

## Related Issues

- #001: Offline/Demo Mode
- #003: Error Messages & Debugging
- #010: Backup & Recovery