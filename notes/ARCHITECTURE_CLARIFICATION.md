# Architecture Clarification: Document Classes

## Concern Addressed
The alert about "potential data primitive logic loss" regarding Document, DocumentCollection, and related logic.

## Current Architecture (V2 → Pure Migration)

### Legacy V2 (egregora/data_primitives/)
Located in `src/egregora/data_primitives/document.py`:
- Contains **placeholder classes only** (`pass` statements)
- Purpose: Backward compatibility stubs for legacy V2 code
- Classes: `Document`, `Author`, `Category`, `DocumentType`, etc.
- **No actual logic** - these are intentionally minimal

### Active Pure (egregora/core/)
Located in `src/egregora/core/types.py`:
- Contains **full implementations** with all business logic
- Follows Atom/RSS spec with Entry → Document hierarchy
- **All essential logic is present**:
  - ✅ `document_id` via `id` field (auto-generated from slug)
  - ✅ `slug` property from `internal_metadata`
  - ✅ `_set_identity_and_timestamps` validator for auto-generation
  - ✅ `with_parent` via Entry's parent relationships
  - ✅ `with_metadata` via `internal_metadata` dict
  - ✅ Hierarchical relationships through Entry inheritance
  - ✅ Markdown rendering via `html_content` property

## Evidence of Complete Implementation

### Document Class (egregora/core/types.py:153-211)
```python
class Document(Entry):
    """Represents an artifact generated by Egregora."""

    doc_type: DocumentType
    status: DocumentStatus = DocumentStatus.DRAFT
    searchable: bool = True
    url_path: str | None = None

    @property
    def slug(self) -> str | None:
        """Get the semantic slug for this document."""
        return self.internal_metadata.get("slug")

    @model_validator(mode="before")
    @classmethod
    def _set_identity_and_timestamps(cls, data: Any) -> Any:
        """Auto-generate id, slug, and timestamps."""
        # Generates slug from title if not present
        # Sets id from slug
        # Auto-timestamps
```

### Entry Base Class (egregora/core/types.py:72-135)
```python
class Entry(BaseModel):
    """Atom-compliant entry with full metadata support."""

    id: str  # Deterministic document ID
    title: str
    updated: datetime
    published: datetime | None = None

    links: list[Link]
    authors: list[Author]
    categories: list[Category]

    content: str | None  # Markdown content
    content_type: str | None

    # Hierarchical relationships
    in_reply_to: InReplyTo | None  # Parent reference
    source: Source | None

    # Metadata handling
    extensions: dict[str, Any]  # Public extensions
    internal_metadata: dict[str, Any]  # Internal metadata

    @property
    def html_content(self) -> str | None:
        """Render markdown to HTML."""
```

## Changes Made During PR Merges

### What Changed
1. **egregora/data_primitives/document.py**:
   - Removed duplicate class definitions (linting error)
   - Kept placeholder `pass` statements (intentional)
   - Added missing `from dataclasses import dataclass` for Author/Category stubs

2. **egregora/core/types.py**:
   - Merged atom sink refactoring (cleaner imports)
   - No business logic was removed or lost

### What Was NOT Changed
- ✅ All Document business logic remains in egregora/core/types.py
- ✅ ID generation logic intact
- ✅ Slug generation intact
- ✅ Metadata handling intact
- ✅ Parent/child relationships intact

## Migration Path

The codebase is in an **intentional dual-state**:
- **V2 (legacy)**: `egregora/data_primitives/` - minimal stubs
- **Pure (active)**: `egregora/core/` - full implementations

New code should use Pure types from `egregora.core.types`.

## Conclusion

**No data primitive logic has been lost.** The Document class in `egregora/core/types.py` contains all essential functionality including:
- Deterministic document ID generation
- Slug management
- Metadata manipulation
- Hierarchical relationships (via Entry inheritance)
- Markdown rendering

The changes made during PR merges were purely structural (removing duplicate definitions, fixing imports) and did not affect any business logic.
