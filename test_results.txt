Using CPython 3.12.12 interpreter at: /home/jules/.pyenv/versions/3.12.12/bin/python3
Creating virtual environment at: .venv
   Building egregora @ file:///app
Downloading pygments (1.2MiB)
Downloading pyarrow (40.8MiB)
Downloading botocore (13.4MiB)
Downloading virtualenv (5.7MiB)
Downloading babel (9.7MiB)
Downloading temporalio (12.3MiB)
Downloading pillow (6.3MiB)
Downloading tokenizers (3.1MiB)
Downloading pandas (11.8MiB)
Downloading ibis-framework (1.8MiB)
Downloading hf-xet (3.0MiB)
Downloading mkdocs (3.7MiB)
Downloading numpy (15.9MiB)
Downloading pydantic-core (2.0MiB)
Downloading deptry (1.8MiB)
Downloading ruff (12.8MiB)
Downloading tiktoken (1.1MiB)
Downloading mkdocs-material (8.8MiB)
Downloading aiohttp (1.7MiB)
Downloading duckdb (19.5MiB)
Downloading lancedb (37.4MiB)
Downloading fastavro (3.3MiB)
Downloading pylance (46.4MiB)
 Downloading tiktoken
 Downloading aiohttp
 Downloading deptry
 Downloading pygments
 Downloading pydantic-core
   Building ratelimit==2.2.1
 Downloading tokenizers
 Downloading hf-xet
 Downloading fastavro
 Downloading mkdocs
      Built egregora @ file:///app
 Downloading virtualenv
 Downloading pillow
 Downloading babel
      Built ratelimit==2.2.1
 Downloading ruff
 Downloading ibis-framework
 Downloading numpy
 Downloading temporalio
 Downloading botocore
 Downloading duckdb
 Downloading lancedb
 Downloading pandas
 Downloading pylance
 Downloading pyarrow
 Downloading mkdocs-material
Installed 191 packages in 639ms
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0 -- /app/.venv/bin/python
cachedir: .pytest_cache
rootdir: /app
configfile: pyproject.toml
plugins: logfire-4.13.0, anyio-4.11.0, respx-0.22.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 273 items / 1 skipped

tests/e2e/cli/test_init_command.py::test_init_creates_all_template_files PASSED [  0%]
tests/e2e/cli/test_init_command.py::test_init_directory_structure PASSED [  0%]
tests/e2e/cli/test_init_command.py::test_egregora_directory_created PASSED [  1%]
tests/e2e/cli/test_init_command.py::test_config_yml_structure PASSED     [  1%]
tests/e2e/cli/test_init_command.py::test_mkdocs_yml_no_extra_egregora FAILED [  1%]
tests/e2e/cli/test_init_command.py::test_prompts_readme_created PASSED   [  2%]
tests/e2e/cli/test_init_command.py::test_prompts_directory_populated PASSED [  2%]
tests/e2e/cli/test_runs_command.py::TestRunsTail::test_runs_tail_with_no_database PASSED [  2%]
tests/e2e/cli/test_runs_command.py::TestRunsTail::test_runs_tail_with_empty_database PASSED [  3%]
tests/e2e/cli/test_runs_command.py::TestRunsTail::test_runs_tail_default_limit PASSED [  3%]
tests/e2e/cli/test_runs_command.py::TestRunsTail::test_runs_tail_custom_limit PASSED [  4%]
tests/e2e/cli/test_runs_command.py::TestRunsTail::test_runs_tail_shows_status_colors PASSED [  4%]
tests/e2e/cli/test_runs_command.py::TestRunsTail::test_runs_tail_shows_row_counts PASSED [  4%]
tests/e2e/cli/test_runs_command.py::TestRunsTail::test_runs_tail_shows_duration PASSED [  5%]
tests/e2e/cli/test_runs_command.py::TestRunsTail::test_runs_tail_ordering PASSED [  5%]
tests/e2e/cli/test_runs_command.py::TestRunsShow::test_runs_show_with_no_database PASSED [  5%]
tests/e2e/cli/test_runs_command.py::TestRunsShow::test_runs_show_nonexistent_run PASSED [  6%]
tests/e2e/cli/test_runs_command.py::TestRunsShow::test_runs_show_full_run_id PASSED [  6%]
tests/e2e/cli/test_runs_command.py::TestRunsShow::test_runs_show_prefix_matching PASSED [  6%]
tests/e2e/cli/test_runs_command.py::TestRunsShow::test_runs_show_displays_panel PASSED [  7%]
tests/e2e/cli/test_runs_command.py::TestRunsShow::test_runs_show_completed_status PASSED [  7%]
tests/e2e/cli/test_runs_command.py::TestRunsShow::test_runs_show_failed_status PASSED [  8%]
tests/e2e/cli/test_runs_command.py::TestRunsShow::test_runs_show_with_trace_id PASSED [  8%]
tests/e2e/cli/test_runs_command.py::TestRunsList::test_runs_list_with_no_database PASSED [  8%]
tests/e2e/cli/test_runs_command.py::TestRunsList::test_runs_list_default PASSED [  9%]
tests/e2e/cli/test_runs_command.py::TestRunsList::test_runs_list_filter_by_stage PASSED [  9%]
tests/e2e/cli/test_runs_command.py::TestRunsList::test_runs_list_filter_by_status PASSED [  9%]
tests/e2e/cli/test_runs_command.py::TestRunsList::test_runs_list_limit PASSED [ 10%]
tests/e2e/cli/test_runs_command.py::TestRunsList::test_runs_list_json_output PASSED [ 10%]
tests/e2e/cli/test_runs_command.py::TestRunsClear::test_runs_clear_with_no_database PASSED [ 10%]
tests/e2e/cli/test_runs_command.py::TestRunsClear::test_runs_clear_requires_confirmation PASSED [ 11%]
tests/e2e/cli/test_runs_command.py::TestRunsClear::test_runs_clear_older_than PASSED [ 11%]
tests/e2e/cli/test_runs_command.py::TestRunsClear::test_runs_clear_dry_run PASSED [ 12%]
tests/e2e/cli/test_runs_command.py::TestRunsClear::test_runs_clear_with_force_flag PASSED [ 12%]
tests/e2e/cli/test_runs_command.py::TestRunsCommandsIntegration::test_runs_workflow PASSED [ 12%]
tests/e2e/cli/test_runs_command.py::TestRunsCommandsIntegration::test_runs_commands_preserve_database PASSED [ 13%]
tests/e2e/cli/test_runs_command.py::TestRunsCommandsEdgeCases::test_runs_tail_with_zero_limit PASSED [ 13%]
tests/e2e/cli/test_runs_command.py::TestRunsCommandsEdgeCases::test_runs_tail_with_negative_limit PASSED [ 13%]
tests/e2e/cli/test_runs_command.py::TestRunsCommandsEdgeCases::test_runs_show_with_empty_run_id PASSED [ 14%]
tests/e2e/cli/test_runs_command.py::TestRunsCommandsEdgeCases::test_runs_tail_large_limit PASSED [ 14%]
tests/e2e/cli/test_runs_command.py::TestRunsCommandsEdgeCases::test_runs_show_case_insensitive_prefix PASSED [ 15%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_command_basic PASSED [ 15%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_command_verbose PASSED [ 15%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_command_verbose_short_flag PASSED [ 16%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_command_shows_summary PASSED [ 16%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_command_checks_python_version PASSED [ 16%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_command_checks_packages PASSED [ 17%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_exit_code_on_success PASSED [ 17%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_exit_code_on_error PASSED [ 17%]
tests/e2e/cli/test_utilities_command.py::TestDoctorCommand::test_doctor_continues_on_warnings PASSED [ 18%]
tests/e2e/cli/test_utilities_command.py::TestCacheStatsCommand::test_cache_stats_empty_cache SKIPPED [ 18%]
tests/e2e/cli/test_utilities_command.py::TestCacheStatsCommand::test_cache_stats_with_nonexistent_dir SKIPPED [ 19%]
tests/e2e/cli/test_utilities_command.py::TestCacheStatsCommand::test_cache_stats_default_directory SKIPPED [ 19%]
tests/e2e/cli/test_utilities_command.py::TestCacheStatsCommand::test_cache_stats_shows_size_info SKIPPED [ 19%]
tests/e2e/cli/test_utilities_command.py::TestCacheStatsCommand::test_cache_stats_shows_per_stage_breakdown SKIPPED [ 20%]
tests/e2e/cli/test_utilities_command.py::TestCacheClearCommand::test_cache_clear_empty_cache SKIPPED [ 20%]
tests/e2e/cli/test_utilities_command.py::TestCacheClearCommand::test_cache_clear_with_force_flag SKIPPED [ 20%]
tests/e2e/cli/test_utilities_command.py::TestCacheClearCommand::test_cache_clear_with_short_force_flag SKIPPED [ 21%]
tests/e2e/cli/test_utilities_command.py::TestCacheClearCommand::test_cache_clear_specific_stage SKIPPED [ 21%]
tests/e2e/cli/test_utilities_command.py::TestCacheClearCommand::test_cache_clear_nonexistent_stage SKIPPED [ 21%]
tests/e2e/cli/test_utilities_command.py::TestCacheClearCommand::test_cache_clear_cancels_without_force SKIPPED [ 22%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_requires_argument SKIPPED [ 22%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_with_keep_last SKIPPED [ 23%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_keep_last_with_stage SKIPPED [ 23%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_with_max_size_gb SKIPPED [ 23%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_with_max_size_mb SKIPPED [ 24%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_rejects_both_flags SKIPPED [ 24%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_invalid_size_format SKIPPED [ 24%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_with_max_size_kb SKIPPED [ 25%]
tests/e2e/cli/test_utilities_command.py::TestCacheGcCommand::test_cache_gc_empty_cache_with_keep_last SKIPPED [ 25%]
tests/e2e/cli/test_utilities_command.py::TestCacheCommandsIntegration::test_cache_workflow_stats_then_clear SKIPPED [ 26%]
tests/e2e/cli/test_utilities_command.py::TestCacheCommandsIntegration::test_cache_workflow_gc_then_stats SKIPPED [ 26%]
tests/e2e/cli/test_utilities_command.py::TestCacheDefaultDirectory::test_cache_stats_with_default_directory SKIPPED [ 26%]
tests/e2e/cli/test_utilities_command.py::TestCacheDefaultDirectory::test_cache_clear_with_default_directory SKIPPED [ 27%]
tests/e2e/cli/test_utilities_command.py::TestCacheDefaultDirectory::test_cache_gc_with_default_directory SKIPPED [ 27%]
tests/e2e/cli/test_utilities_command.py::TestDoctorAndCacheOutputFormat::test_doctor_output_is_readable SKIPPED [ 27%]
tests/e2e/cli/test_utilities_command.py::TestDoctorAndCacheOutputFormat::test_cache_stats_output_is_readable SKIPPED [ 28%]
tests/e2e/cli/test_utilities_command.py::TestDoctorAndCacheOutputFormat::test_cache_commands_error_messages_are_helpful SKIPPED [ 28%]
tests/e2e/cli/test_write_command.py::TestWriteCommandBasic::test_write_command_basic PASSED [ 28%]
tests/e2e/cli/test_write_command.py::TestWriteCommandBasic::test_write_command_missing_input PASSED [ 29%]
tests/e2e/cli/test_write_command.py::TestWriteCommandBasic::test_write_command_invalid_source PASSED [ 29%]
tests/e2e/cli/test_write_command.py::TestWriteCommandBasic::test_write_command_help PASSED [ 30%]
tests/e2e/cli/test_write_command.py::TestWriteCommandConfiguration::test_write_command_with_step_size PASSED [ 30%]
tests/e2e/cli/test_write_command.py::TestWriteCommandConfiguration::test_write_command_with_message_windowing PASSED [ 30%]
tests/e2e/cli/test_write_command.py::TestWriteCommandConfiguration::test_write_command_with_hour_windowing PASSED [ 31%]
tests/e2e/cli/test_write_command.py::TestWriteCommandConfiguration::test_write_command_with_overlap PASSED [ 31%]
tests/e2e/cli/test_write_command.py::TestWriteCommandConfiguration::test_write_command_disable_enrichment PASSED [ 31%]
tests/e2e/cli/test_write_command.py::TestWriteCommandConfiguration::test_write_command_invalid_step_unit PASSED [ 32%]
tests/e2e/cli/test_write_command.py::TestWriteCommandDateFiltering::test_write_command_with_from_date PASSED [ 32%]
tests/e2e/cli/test_write_command.py::TestWriteCommandDateFiltering::test_write_command_with_to_date PASSED [ 32%]
tests/e2e/cli/test_write_command.py::TestWriteCommandDateFiltering::test_write_command_with_date_range PASSED [ 33%]
tests/e2e/cli/test_write_command.py::TestWriteCommandDateFiltering::test_write_command_invalid_from_date_format PASSED [ 33%]
tests/e2e/cli/test_write_command.py::TestWriteCommandDateFiltering::test_write_command_invalid_to_date_format PASSED [ 34%]
tests/e2e/cli/test_write_command.py::TestWriteCommandDateFiltering::test_write_command_with_timezone PASSED [ 34%]
tests/e2e/cli/test_write_command.py::TestWriteCommandDateFiltering::test_write_command_with_invalid_timezone PASSED [ 34%]
tests/e2e/cli/test_write_command.py::TestWriteCommandWithMocks::test_write_command_end_to_end PASSED [ 35%]
tests/e2e/cli/test_write_command.py::TestWriteCommandEdgeCases::test_write_command_with_relative_output_path PASSED [ 35%]
tests/e2e/cli/test_write_command.py::TestWriteCommandEdgeCases::test_write_command_with_absolute_paths PASSED [ 35%]
tests/e2e/cli/test_write_command.py::TestWriteCommandEdgeCases::test_write_command_output_directory_creation PASSED [ 36%]
tests/e2e/cli/test_write_command.py::TestWriteCommandEdgeCases::test_write_command_all_options_combined PASSED [ 36%]
tests/e2e/database/test_duckdb_sequences.py::test_annotation_store_initialization PASSED [ 36%]
tests/e2e/database/test_duckdb_sequences.py::test_run_tracking_with_sequences PASSED [ 37%]
tests/e2e/database/test_duckdb_sequences.py::test_sequence_operations_e2e PASSED [ 37%]
tests/e2e/database/test_duckdb_sequences.py::test_pipeline_with_annotation_store SKIPPED [ 38%]
tests/e2e/database/test_duckdb_upsert_helper.py::test_replace_rows_prevents_duplicate_ratings PASSED [ 38%]
tests/e2e/input_adapters/test_dynamic_parser.py::test_dynamic_regex_generator_success PASSED [ 38%]
tests/e2e/input_adapters/test_dynamic_parser.py::test_dynamic_regex_generator_failure PASSED [ 39%]
tests/e2e/input_adapters/test_dynamic_parser.py::test_dynamic_regex_caching PASSED [ 39%]
tests/e2e/input_adapters/test_iperon_tjro_adapter.py::test_adapter_parses_mock_payload PASSED [ 39%]
tests/e2e/input_adapters/test_self_reflection_adapter.py::test_self_adapter_parses_existing_site PASSED [ 40%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_zip_extraction_completes_without_error PASSED [ 40%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_pipeline_rejects_unsafe_zip PASSED [ 41%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_produces_valid_table ERROR [ 41%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_handles_portuguese_dates ERROR [ 41%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_preserves_all_messages ERROR [ 42%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_extracts_media_references ERROR [ 42%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_enforces_message_schema ERROR [ 42%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_anonymization_removes_real_author_names ERROR [ 43%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parse_source_exposes_raw_authors_when_requested ERROR [ 43%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_anonymization_is_deterministic ERROR [ 43%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_anonymized_uuids_are_valid_format ERROR [ 44%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_media_extraction_creates_expected_files PASSED [ 44%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_media_references_replaced_in_messages ERROR [ 45%]
tests/e2e/input_adapters/test_whatsapp_adapter.py::test_egregora_commands_are_filtered_out ERROR [ 45%]
tests/e2e/output_adapters/test_parquet_adapter.py::test_parquet_adapter_persist_and_get PASSED [ 45%]
tests/e2e/pipeline/test_site_generation.py::test_site_generation_e2e PASSED [ 46%]
tests/e2e/pipeline/test_write_pipeline_e2e.py::test_full_pipeline_smoke_test PASSED [ 46%]
tests/e2e/pipeline/test_write_pipeline_e2e.py::test_pipeline_respects_mocked_llm_responses PASSED [ 46%]
tests/e2e/pipeline/test_write_pipeline_e2e.py::test_pipeline_with_rag_enabled PASSED [ 47%]
tests/e2e/pipeline/test_write_pipeline_e2e.py::test_mock_fixtures_are_available PASSED [ 47%]
tests/e2e/pipeline/test_write_pipeline_e2e.py::test_url_enrichment_mock_returns_fixture_data PASSED [ 47%]
tests/e2e/pipeline/test_write_pipeline_e2e.py::test_media_enrichment_mock_returns_fixture_data PASSED [ 48%]
tests/e2e/pipeline/test_write_pipeline_e2e.py::test_mock_performance_baseline PASSED [ 48%]
tests/e2e/test_extended_e2e.py::test_reader_agent_evaluates_posts_and_persists_elo_rankings PASSED [ 49%]
tests/e2e/test_fast_with_mock.py::test_mock_embeddings_are_deterministic ERROR [ 49%]
tests/e2e/test_fast_with_mock.py::test_mock_embeddings_different_for_different_text ERROR [ 49%]
tests/test_caching.py::test_enrichment_persistence PASSED                [ 50%]
tests/test_caching.py::test_writer_cache_persistence PASSED              [ 50%]
tests/test_caching.py::test_force_refresh PASSED                         [ 50%]
tests/unit/agents/banner/test_banner_image_generation.py::test_generate_banner_image_preserves_request_prompt PASSED [ 51%]
tests/unit/agents/banner/test_gemini_provider.py::test_gemini_provider_returns_image_and_debug_text PASSED [ 51%]
tests/unit/agents/banner/test_gemini_provider.py::test_gemini_provider_returns_error_when_no_image PASSED [ 52%]
tests/unit/agents/test_enricher_tasks.py::test_extract_url_candidates_short_circuits_when_limit_not_positive[0] PASSED [ 52%]
tests/unit/agents/test_enricher_tasks.py::test_extract_url_candidates_short_circuits_when_limit_not_positive[-1] PASSED [ 52%]
tests/unit/agents/test_rag_exception_handling.py::TestRAGExceptionHandling::test_exception_during_indexing_is_caught PASSED [ 53%]
tests/unit/agents/test_rag_exception_handling.py::TestRAGExceptionHandling::test_successful_indexing_logs_count PASSED [ 53%]
tests/unit/agents/test_rag_exception_handling.py::TestRAGExceptionHandling::test_no_indexing_when_rag_disabled PASSED [ 53%]
tests/unit/agents/test_rag_exception_handling.py::TestRAGExceptionHandling::test_no_indexing_when_no_posts_saved PASSED [ 54%]
tests/unit/agents/test_rag_exception_handling.py::TestRAGExceptionHandling::test_rag_enabled_by_default PASSED [ 54%]
tests/unit/agents/test_rag_exception_handling.py::TestPipelineRAGExceptionHandling::test_prepare_pipeline_catches_exceptions PASSED [ 54%]
tests/unit/agents/test_rag_exception_handling.py::TestPipelineRAGExceptionHandling::test_index_media_is_disabled PASSED [ 55%]
tests/unit/agents/test_tool_registry.py::test_profiles_raise_for_non_mapping_profile PASSED [ 55%]
tests/unit/agents/test_tool_registry.py::test_profiles_raise_for_non_sequence_allow_or_deny PASSED [ 56%]
tests/unit/agents/test_writer_capabilities.py::test_register_writer_tools_registers_core_tools PASSED [ 56%]
tests/unit/agents/test_writer_capabilities.py::test_register_writer_tools_invokes_capabilities_once PASSED [ 56%]
tests/unit/agents/test_writer_tools.py::TestWriterToolsExtraction::test_write_post_impl_creates_document PASSED [ 57%]
tests/unit/agents/test_writer_tools.py::TestWriterToolsExtraction::test_read_profile_impl_returns_content PASSED [ 57%]
tests/unit/agents/test_writer_tools.py::TestWriterToolsExtraction::test_read_profile_impl_handles_missing_profile PASSED [ 57%]
tests/unit/agents/test_writer_tools.py::TestWriterToolsExtraction::test_write_profile_impl_creates_document PASSED [ 58%]
tests/unit/agents/test_writer_tools.py::TestWriterToolsExtraction::test_search_media_impl_handles_rag_errors PASSED [ 58%]
tests/unit/agents/test_writer_tools.py::TestWriterToolsExtraction::test_annotate_conversation_impl_raises_without_store PASSED [ 58%]
tests/unit/agents/test_writer_tools.py::TestWriterToolsExtraction::test_annotate_conversation_impl_saves_annotation PASSED [ 59%]
tests/unit/agents/test_writer_tools.py::TestWriterToolsExtraction::test_generate_banner_impl_handles_failure PASSED [ 59%]
tests/unit/agents/test_writer_tools.py::TestToolContexts::test_tool_context_creation PASSED [ 60%]
tests/unit/agents/test_writer_tools.py::TestToolContexts::test_annotation_context_creation PASSED [ 60%]
tests/unit/agents/test_writer_tools.py::TestToolContexts::test_banner_context_creation PASSED [ 60%]
tests/unit/agents/test_writer_tools.py::TestImportFix::test_rag_imports_work PASSED [ 61%]
tests/unit/config/test_validation.py::test_config_validate_with_valid_config PASSED [ 61%]
tests/unit/config/test_validation.py::test_config_validate_with_invalid_model_format PASSED [ 61%]
tests/unit/config/test_validation.py::test_config_validate_model_name_validator PASSED [ 62%]
tests/unit/config/test_validation.py::test_config_validate_cross_field_rag_requires_lancedb PASSED [ 62%]
tests/unit/config/test_validation.py::test_config_privacy_settings_defaults PASSED [ 63%]
tests/unit/config/test_validation.py::test_config_privacy_settings_configurable PASSED [ 63%]
tests/unit/config/test_validation.py::test_config_rag_top_k_bounds PASSED [ 63%]
tests/unit/config/test_validation.py::test_config_creates_default_if_missing PASSED [ 64%]
tests/unit/config/test_validation.py::test_config_yaml_roundtrip PASSED  [ 64%]
tests/unit/dev_tools/test_check_private_imports.py::TestPrivateImportsChecker::test_check_all_for_private_names_detects_violation PASSED [ 64%]
tests/unit/dev_tools/test_check_private_imports.py::TestPrivateImportsChecker::test_check_all_for_private_names_allows_public_names PASSED [ 65%]
tests/unit/dev_tools/test_check_private_imports.py::TestPrivateImportsChecker::test_check_private_imports_detects_violation PASSED [ 65%]
tests/unit/dev_tools/test_check_private_imports.py::TestPrivateImportsChecker::test_check_private_imports_allows_public PASSED [ 65%]
tests/unit/dev_tools/test_check_private_imports.py::TestPrivateImportsChecker::test_check_private_imports_allows_dunder PASSED [ 66%]
tests/unit/dev_tools/test_check_private_imports.py::TestPrivateImportsChecker::test_check_private_imports_flags_ibis_underscore PASSED [ 66%]
tests/unit/dev_tools/test_check_private_imports.py::TestRegressionTests::test_avatar_import_was_violation PASSED [ 67%]
tests/unit/input_adapters/test_registry.py::test_registry_falls_back_to_builtin_adapters PASSED [ 67%]
tests/unit/output_adapters/mkdocs/test_scaffolding.py::test_scaffold_site_creates_expected_layout PASSED [ 67%]
tests/unit/output_adapters/mkdocs/test_scaffolding.py::test_scaffold_site_respects_existing_mkdocs PASSED [ 68%]
tests/unit/output_adapters/mkdocs/test_scaffolding.py::test_resolve_paths_returns_site_configuration PASSED [ 68%]
tests/unit/output_adapters/mkdocs/test_scaffolding.py::test_main_py_and_overrides_in_egregora_dir PASSED [ 68%]
tests/unit/output_adapters/mkdocs/test_url_convention.py::test_mkdocs_adapter_embeds_and_applies_standard_url_convention PASSED [ 69%]
tests/unit/output_adapters/test_conventions.py::TestUrlExtensionRemoval::test_removes_extension_from_simple_path PASSED [ 69%]
tests/unit/output_adapters/test_conventions.py::TestUrlExtensionRemoval::test_removes_extension_from_nested_path PASSED [ 69%]
tests/unit/output_adapters/test_conventions.py::TestUrlExtensionRemoval::test_preserves_dots_in_directory_names PASSED [ 70%]
tests/unit/output_adapters/test_conventions.py::TestUrlExtensionRemoval::test_handles_no_extension PASSED [ 70%]
tests/unit/output_adapters/test_conventions.py::TestUrlExtensionRemoval::test_handles_multiple_dots PASSED [ 71%]
tests/unit/output_adapters/test_conventions.py::TestUrlExtensionRemoval::test_preserves_dotfiles PASSED [ 71%]
tests/unit/output_adapters/test_conventions.py::TestStandardUrlConventionPurity::test_post_url_is_pure_string PASSED [ 71%]
tests/unit/output_adapters/test_conventions.py::TestStandardUrlConventionPurity::test_enrichment_url_removes_extension_via_string_ops PASSED [ 72%]
tests/unit/output_adapters/test_conventions.py::TestStandardUrlConventionPurity::test_media_enrichment_preserves_path_structure PASSED [ 72%]
tests/unit/output_adapters/test_conventions.py::TestStandardUrlConventionPurity::test_profile_url_generation PASSED [ 72%]
tests/unit/output_adapters/test_conventions.py::TestStandardUrlConventionPurity::test_journal_url_generation PASSED [ 73%]
tests/unit/output_adapters/test_conventions.py::TestUrlConventionNoFilesystemDependency::test_no_path_import_in_conventions_module PASSED [ 73%]
tests/unit/output_adapters/test_conventions.py::TestUrlConventionNoFilesystemDependency::test_no_path_operations_in_canonical_url PASSED [ 73%]
tests/unit/output_adapters/test_conventions.py::TestUrlConventionNoFilesystemDependency::test_no_path_operations_in_helper_methods PASSED [ 74%]
tests/unit/privacy/test_privacy_config.py::test_anonymize_table_disabled PASSED [ 74%]
tests/unit/privacy/test_privacy_config.py::test_anonymize_table_enabled PASSED [ 75%]
tests/unit/privacy/test_privacy_config.py::test_anonymize_table_with_author_column PASSED [ 75%]
tests/unit/privacy/test_privacy_config.py::test_anonymize_table_missing_columns PASSED [ 75%]
tests/unit/rag/test_duckdb_integration.py::test_search_to_table_basic PASSED [ 76%]
tests/unit/rag/test_duckdb_integration.py::test_search_to_table_empty_results PASSED [ 76%]
tests/unit/rag/test_duckdb_integration.py::test_search_to_table_with_sql_filtering PASSED [ 76%]
tests/unit/rag/test_duckdb_integration.py::test_search_with_filters_min_score PASSED [ 77%]
tests/unit/rag/test_duckdb_integration.py::test_search_with_filters_document_type PASSED [ 77%]
tests/unit/rag/test_duckdb_integration.py::test_search_with_filters_combined PASSED [ 78%]
tests/unit/rag/test_duckdb_integration.py::test_search_to_table_preserves_metadata PASSED [ 78%]
tests/unit/rag/test_duckdb_integration.py::test_search_to_table_ordering PASSED [ 78%]
tests/unit/rag/test_embedding_router.py::test_rate_limiter_initial_state PASSED [ 79%]
tests/unit/rag/test_embedding_router.py::test_rate_limiter_mark_rate_limited PASSED [ 79%]
tests/unit/rag/test_embedding_router.py::test_rate_limiter_mark_error PASSED [ 79%]
tests/unit/rag/test_embedding_router.py::test_rate_limiter_max_errors PASSED [ 80%]
tests/unit/rag/test_embedding_router.py::test_rate_limiter_mark_success PASSED [ 80%]
tests/unit/rag/test_embedding_router.py::test_router_prefers_single_endpoint_for_low_latency PASSED [ 80%]
tests/unit/rag/test_embedding_router.py::test_router_falls_back_to_batch_when_single_exhausted PASSED [ 81%]
tests/unit/rag/test_embedding_router.py::test_router_handles_429_rate_limit PASSED [ 81%]
tests/unit/rag/test_embedding_router.py::test_router_accumulates_requests_during_rate_limit PASSED [ 82%]
tests/unit/rag/test_embedding_router.py::test_endpoint_queue_processes_single_request PASSED [ 82%]
tests/unit/rag/test_embedding_router.py::test_endpoint_queue_batches_multiple_requests PASSED [ 82%]
tests/unit/rag/test_embedding_router.py::test_endpoint_queue_handles_api_error PASSED [ 83%]
tests/unit/rag/test_embedding_router.py::test_full_workflow_with_both_endpoints PASSED [ 83%]
tests/unit/rag/test_embedding_router.py::test_concurrent_requests_under_rate_limits PASSED [ 83%]
tests/unit/rag/test_lancedb_backend.py::test_lancedb_backend_initialization PASSED [ 84%]
tests/unit/rag/test_lancedb_backend.py::test_lancedb_backend_index_documents PASSED [ 84%]
tests/unit/rag/test_lancedb_backend.py::test_lancedb_backend_query PASSED [ 84%]
tests/unit/rag/test_lancedb_backend.py::test_lancedb_backend_empty_query PASSED [ 85%]
tests/unit/rag/test_lancedb_backend.py::test_lancedb_backend_index_binary_content PASSED [ 85%]
tests/unit/rag/test_rag_backend_factory.py::test_embed_fn_uses_rag_settings_for_router PASSED [ 86%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_small_document PASSED [ 86%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_large_document PASSED [ 86%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_preserves_metadata PASSED [ 87%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_filters_binary_content PASSED [ 87%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_filters_by_document_type PASSED [ 87%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_multiple_documents PASSED [ 88%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_word_boundary_splitting PASSED [ 88%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_index_empty_documents PASSED [ 89%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_index_documents_idempotency PASSED [ 89%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_index_documents_with_custom_types PASSED [ 89%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_index_large_batch PASSED [ 90%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_index_embedding_failure PASSED [ 90%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_index_embedding_count_mismatch PASSED [ 90%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_query_basic PASSED [ 91%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_query_top_k_limit PASSED [ 91%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_query_empty_database PASSED [ 91%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_query_score_range PASSED [ 92%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_query_metadata_preservation PASSED [ 92%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_query_chunk_id_format PASSED [ 93%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_asymmetric_embeddings PASSED [ 93%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_query_with_filters PASSED [ 93%]
tests/unit/rag/test_rag_comprehensive.py::test_high_level_api_index_and_search PASSED [ 94%]
tests/unit/rag/test_rag_comprehensive.py::test_high_level_api_backend_singleton PASSED [ 94%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_empty_document PASSED [ 94%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_whitespace_only PASSED [ 95%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_single_long_word PASSED [ 95%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_persistence_across_sessions PASSED [ 95%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_multiple_tables PASSED [ 96%]
tests/unit/rag/test_rag_comprehensive.py::test_chunking_performance PASSED [ 96%]
tests/unit/rag/test_rag_comprehensive.py::test_backend_concurrent_queries PASSED [ 97%]
tests/unit/rag/test_rag_comprehensive.py::test_end_to_end_workflow PASSED [ 97%]
tests/unit/utils/test_network.py::test_validate_public_url_allows_public_ipv4 PASSED [ 97%]
tests/unit/utils/test_network.py::test_validate_public_url_rejects_bad_scheme[ftp://example.com/file] PASSED [ 98%]
tests/unit/utils/test_network.py::test_validate_public_url_rejects_bad_scheme[mailto:user@example.com] PASSED [ 98%]
tests/unit/utils/test_network.py::test_validate_public_url_blocks_private_range PASSED [ 98%]
tests/unit/utils/test_network.py::test_validate_public_url_blocks_ipv4_mapped PASSED [ 99%]
tests/unit/utils/test_network.py::test_validate_public_url_resolve_failure PASSED [ 99%]
tests/utils/test_no_cassettes.py::test_no_recorded_cassettes_committed PASSED [100%]

==================================== ERRORS ====================================
______________ ERROR at setup of test_parser_produces_valid_table ______________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 80
  def test_parser_produces_valid_table(whatsapp_fixture: WhatsAppFixture, _mock_dynamic_regex_fallback):
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:80
____________ ERROR at setup of test_parser_handles_portuguese_dates ____________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 94
  def test_parser_handles_portuguese_dates(whatsapp_fixture: WhatsAppFixture, _mock_dynamic_regex_fallback):
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:94
_____________ ERROR at setup of test_parser_preserves_all_messages _____________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 105
  def test_parser_preserves_all_messages(whatsapp_fixture: WhatsAppFixture, _mock_dynamic_regex_fallback):
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:105
___________ ERROR at setup of test_parser_extracts_media_references ____________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 113
  def test_parser_extracts_media_references(whatsapp_fixture: WhatsAppFixture, _mock_dynamic_regex_fallback):
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:113
____________ ERROR at setup of test_parser_enforces_message_schema _____________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 123
  def test_parser_enforces_message_schema(whatsapp_fixture: WhatsAppFixture, _mock_dynamic_regex_fallback):
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:123
________ ERROR at setup of test_anonymization_removes_real_author_names ________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 137
  def test_anonymization_removes_real_author_names(
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:137
____ ERROR at setup of test_parse_source_exposes_raw_authors_when_requested ____
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 152
  def test_parse_source_exposes_raw_authors_when_requested(
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:152
____________ ERROR at setup of test_anonymization_is_deterministic _____________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 174
  def test_anonymization_is_deterministic(whatsapp_fixture: WhatsAppFixture, _mock_dynamic_regex_fallback):
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:174
___________ ERROR at setup of test_anonymized_uuids_are_valid_format ___________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 186
  def test_anonymized_uuids_are_valid_format(whatsapp_fixture: WhatsAppFixture, _mock_dynamic_regex_fallback):
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:186
_________ ERROR at setup of test_media_references_replaced_in_messages _________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 231
  def test_media_references_replaced_in_messages(
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:231
__________ ERROR at setup of test_egregora_commands_are_filtered_out ___________
file /app/tests/e2e/input_adapters/test_whatsapp_adapter.py, line 261
  def test_egregora_commands_are_filtered_out(whatsapp_fixture: WhatsAppFixture, _mock_dynamic_regex_fallback):
E       fixture '_mock_dynamic_regex_fallback' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_dynamic_regex_fallback, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/input_adapters/test_whatsapp_adapter.py:261
___________ ERROR at setup of test_mock_embeddings_are_deterministic ___________
file /app/tests/e2e/test_fast_with_mock.py, line 20
  def test_mock_embeddings_are_deterministic(_mock_batch_client):
E       fixture '_mock_batch_client' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/test_fast_with_mock.py:20
_____ ERROR at setup of test_mock_embeddings_different_for_different_text ______
file /app/tests/e2e/test_fast_with_mock.py, line 36
  def test_mock_embeddings_different_for_different_text(_mock_batch_client):
E       fixture '_mock_batch_client' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _ibis_backend, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, clean_duckdb_path, cleanup_temp_files, config_factory, doctest_namespace, enrichment_test_config, ensure_db_cleanup, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_api_key, isolated_temp_dir, llm_response_mocks, minimal_config, mock_batch_client, mock_embedding_model, mock_vector_store, mocked_writer_agent, monkeypatch, pipeline_test_config, pytestconfig, reader_test_config, record_property, record_testsuite_property, record_xml_attribute, recwarn, respx_mock, stub_enrichment_agents, test_config, test_dates, test_model_settings, test_rag_settings, test_rag_settings_enabled, test_timeout, test_timeouts, test_timezones, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, whatsapp_fixture, whatsapp_timezone, window_configs, writer_test_agent
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/e2e/test_fast_with_mock.py:36
=================================== FAILURES ===================================
______________________ test_mkdocs_yml_no_extra_egregora _______________________

tmp_path = PosixPath('/tmp/pytest-of-jules/pytest-0/test_mkdocs_yml_no_extra_egreg0')

    def test_mkdocs_yml_no_extra_egregora(tmp_path: Path):
        """Test that mkdocs.yml doesn't have extra.egregora."""
        from egregora.init.scaffolding import ensure_mkdocs_project
>       from egregora.output_adapters.mkdocs.adapter import _safe_yaml_load
E       ImportError: cannot import name '_safe_yaml_load' from 'egregora.output_adapters.mkdocs.adapter' (/app/src/egregora/output_adapters/mkdocs/adapter.py)

tests/e2e/cli/test_init_command.py:132: ImportError
=============================== warnings summary ===============================
tests/e2e/pipeline/test_write_pipeline_e2e.py::test_full_pipeline_smoke_test
  /app/.venv/lib/python3.12/site-packages/pydantic_graph/_utils.py:54: DeprecationWarning: There is no current event loop
    event_loop = asyncio.get_event_loop()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/e2e/cli/test_init_command.py::test_mkdocs_yml_no_extra_egregora
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_produces_valid_table
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_handles_portuguese_dates
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_preserves_all_messages
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_extracts_media_references
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parser_enforces_message_schema
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_anonymization_removes_real_author_names
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_parse_source_exposes_raw_authors_when_requested
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_anonymization_is_deterministic
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_anonymized_uuids_are_valid_format
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_media_references_replaced_in_messages
ERROR tests/e2e/input_adapters/test_whatsapp_adapter.py::test_egregora_commands_are_filtered_out
ERROR tests/e2e/test_fast_with_mock.py::test_mock_embeddings_are_deterministic
ERROR tests/e2e/test_fast_with_mock.py::test_mock_embeddings_different_for_different_text
== 1 failed, 230 passed, 30 skipped, 1 warning, 13 errors in 67.39s (0:01:07) ==
