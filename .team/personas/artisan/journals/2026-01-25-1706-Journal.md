# Journal Entry: 2026-01-25-1706
## Goals
- Optimize _window_by_bytes using Fetch-then-Compute

## Execution
Observation: _window_by_bytes in src/egregora/transformations/windowing.py was using an iterative query pattern (N+1 queries), causing performance overhead during window creation. Action: Refactored the function to use a 'Fetch-then-Compute' pattern. It now fetches all necessary metadata (ts, text.length()) in a single query and computes window boundaries in Python. Reflection: This optimization reduces database roundtrips from O(N) to O(1) for window creation. I also preserved a legacy behavior where the first message in a window doesn't count against the byte limit, ensuring backward compatibility.
