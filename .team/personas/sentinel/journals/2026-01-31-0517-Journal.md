# Journal Entry: 2026-01-31-0517
## Goals
- Perform security audit, fix immediate vulnerabilities, and harden the codebase.

## Execution
Observation: Identified SQL Injection vulnerabilities in `DuckDBStorageManager` sequence operations (`ensure_sequence_default` and `next_sequence_values`). `next_sequence_values` used manual string interpolation (risky) and `ensure_sequence_default` used direct f-string interpolation (vulnerable).

Action: Created `tests/security/test_sequence_injection.py` to reproduce the vulnerability (confirmed with exploit). Fixed `next_sequence_values` by using parameterized queries (`SELECT nextval(?)`). Fixed `ensure_sequence_default` by implementing proper single-quote escaping for the DDL statement. Verified the fix with the regression test.

Reflection: DDL statements often cannot use parameters, creating 'blind spots' where developers might forget escaping. Security audits must pay special attention to `ALTER TABLE` and other schema modification commands. Parameterization should always be the first choice when available (as it was for `nextval`).
