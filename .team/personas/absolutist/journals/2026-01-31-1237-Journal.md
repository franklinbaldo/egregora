# Journal Entry: 2026-01-31-1237
## Goals
- Identify and remove one piece of verified legacy code

## Execution
Observation: Identified the `get_router` function and global singleton state in `src/egregora/rag/embedding_router.py` as a legacy compatibility layer. The module `src/egregora/rag/__init__.py` relied on this implicit singleton.

Action:
- Refactored `src/egregora/rag/__init__.py` to explicitly own and manage the `EmbeddingRouter` singleton lifecycle using a thread-safe `_get_module_router` helper and the `create_embedding_router` factory.
- Removed the legacy `get_router` function, `shutdown_router`, and the global `_router` variable from `src/egregora/rag/embedding_router.py`, making it a stateless library module.
- Updated unit tests in `tests/unit/rag/test_rag_backend_factory.py` to mock the new `create_embedding_router` mechanism.

Reflection: The codebase is cleaner and adheres to the principle of explicit lifecycle management. The legacy "backward compatibility" shim is gone, and the RAG module now properly owns its resources. The behavior was verified to be preserved (singleton pattern maintained within the module) via custom reproduction scripts and unit tests.
