ERA001 Found commented-out code
  --> src/egregora/agents/banner/gemini_provider.py:76:9
   |
74 |         # Disabled until API support is consistent or model version is updated.
75 |         # if request.aspect_ratio:
76 |         #     payload["request"]["generation_config"]["aspectRatio"] = request.aspect_ratio
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
77 |
78 |         return payload
   |
help: Remove commented-out code

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> src/egregora/agents/commands.py:134:16
    |
132 |             date = timestamp.split("T")[0]  # Fallback to date part
133 |     else:
134 |         date = datetime.now().date().isoformat()
    |                ^^^^^^^^^^^^^^
135 |
136 |     # Generate content based on command type
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/agents/enricher.py:159:13
    |
157 |             response = await client.get(jina_url, headers=headers, timeout=30.0)
158 |             response.raise_for_status()
159 |             return response.text
    |             ^^^^^^^^^^^^^^^^^^^^
160 |         except (httpx.RequestError, httpx.HTTPStatusError) as exc:
161 |             return f"Jina fetch failed: {exc}"
    |

BLE001 Do not catch blind exception: `Exception`
   --> src/egregora/agents/enricher.py:748:20
    |
746 |                 logger.info("[URLEnricher] Using single-call batch mode for %d URLs", total)
747 |                 return self._execute_url_single_call(tasks_data)
748 |             except Exception as single_call_exc:
    |                    ^^^^^^^^^
749 |                 logger.warning(
750 |                     "[URLEnricher] Single-call batch failed (%s), falling back to individual",
    |

TRY301 Abstract `raise` to an inner function
    --> src/egregora/agents/enricher.py:1069:17
     |
1067 |             if not full_path:
1068 |                 msg = f"Media file {original_filename} not found in ZIP"
1069 |                 raise MediaStagingError(msg)
     |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1070 |
1071 |             safe_name = f"{task['task_id']}_{Path(full_path).name}"
     |

TRY300 Consider moving this statement to an `else` block
    --> src/egregora/agents/enricher.py:1081:13
     |
1080 |             self.staged_files.add(str(target_path))
1081 |             return target_path
     |             ^^^^^^^^^^^^^^^^^^
1082 |         except Exception as exc:
1083 |             msg = f"Failed to stage media file {original_filename}: {exc}"
     |

BLE001 Do not catch blind exception: `Exception`
    --> src/egregora/agents/enricher.py:1349:20
     |
1347 |                 logger.info("[MediaEnricher] Processed %s via individual call", tag)
1348 |
1349 |             except Exception as exc:
     |                    ^^^^^^^^^
1350 |                 logger.warning("[MediaEnricher] Individual call failed for %s: %s", tag, exc)
1351 |                 result = type(
     |

TRY300 Consider moving this statement to an `else` block
  --> src/egregora/agents/formatting.py:38:9
   |
36 |     try:
37 |         doc = output_sink.read_document(DocumentType.JOURNAL, latest.identifier)
38 |         return doc.content
   |         ^^^^^^^^^^^^^^^^^^
39 |     except DocumentNotFoundError:
40 |         return ""
   |

SIM108 Use ternary operator `aspect = title_parts[1].strip() if len(title_parts) > 1 else title` instead of `if`-`else`-block
  --> src/egregora/agents/profile/generator.py:91:5
   |
89 |       # Extract meaningful part from title (remove author name prefix if present)
90 |       title_parts = title.split(":", 1)
91 | /     if len(title_parts) > 1:
92 | |         # Title like "John Doe: Technical Contributions" -> use "Technical Contributions"
93 | |         aspect = title_parts[1].strip()
94 | |     else:
95 | |         aspect = title
   | |______________________^
96 |
97 |       # Slugify the aspect
   |
help: Replace `if`-`else`-block with `aspect = title_parts[1].strip() if len(title_parts) > 1 else title`

G004 Logging statement uses f-string
   --> src/egregora/agents/profile/generator.py:414:30
    |
413 |         except (ValueError, TypeError) as e:
414 |             logger.exception(f"Failed to generate profile for {author_name}: {e}")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
415 |             continue
    |
help: Convert to lazy `%` formatting

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/agents/profile/generator.py:414:79
    |
413 |         except (ValueError, TypeError) as e:
414 |             logger.exception(f"Failed to generate profile for {author_name}: {e}")
    |                                                                               ^
415 |             continue
    |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/agents/profile/history.py:178:13
    |
177 |             logger.info("Loaded %d profile posts for %s from database", len(posts), author_uuid)
178 |             return posts
    |             ^^^^^^^^^^^^
179 |
180 |         except ibis.common.exceptions.IbisError as e:
    |

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> src/egregora/agents/profile/history.py:213:24
    |
211 |             else:
212 |                 # Fallback for non-standard naming
213 |                 date = datetime.now().strftime("%Y-%m-%d")
    |                        ^^^^^^^^^^^^^^
214 |                 aspect = "General Profile"
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

BLE001 Do not catch blind exception: `Exception`
   --> src/egregora/agents/shared/annotations/__init__.py:303:20
    |
301 |             try:
302 |                 self.output_sink.persist(annotation.to_document())
303 |             except Exception as exc:
    |                    ^^^^^^^^^
304 |                 logger.warning("Failed to persist annotation %s: %s", annotation.id, exc)
    |

G201 Logging `.exception(...)` should be used instead of `.error(..., exc_info=True)`
   --> src/egregora/agents/tools/skill_injection.py:140:16
    |
138 |     except Exception as e:
139 |         error_msg = f"Sub-agent execution failed: {e}"
140 |         logger.error(error_msg, exc_info=True)
    |                ^^^^^
141 |         return f"ERROR: {error_msg}"
    |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/agents/writer.py:302:9
    |
300 |         params.output_sink.persist(doc)
301 |         logger.info("Saved journal entry: %s", doc.document_id)
302 |         return doc.document_id
    |         ^^^^^^^^^^^^^^^^^^^^^^
303 |     except (TemplateNotFound, TemplateError) as exc:
304 |         msg = f"Journal template error for window {params.window_label}: {exc}"
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/agents/writer.py:442:56
    |
440 |                 result = _run_agent_sync(loop)
441 |     except Exception as e:
442 |         logger.exception("Error during agent run: %s", e)
    |                                                        ^
443 |         raise
444 |     finally:
    |

SIM102 Use a single `if` statement instead of nested `if` statements
   --> src/egregora/agents/writer.py:594:5
    |
592 |           return True
593 |
594 | /     if isinstance(exc, ModelHTTPError):
595 | |         # Always cycle on client/server errors
596 | |         if exc.status_code >= 400:
    | |__________________________________^
597 |               return True
    |
help: Combine `if` statements using `and`

PLR2004 Magic value used in comparison, consider replacing `400` with a constant variable
   --> src/egregora/agents/writer.py:596:31
    |
594 |     if isinstance(exc, ModelHTTPError):
595 |         # Always cycle on client/server errors
596 |         if exc.status_code >= 400:
    |                               ^^^
597 |             return True
    |

SIM103 Return the condition directly
   --> src/egregora/agents/writer.py:599:5
    |
597 |               return True
598 |
599 | /     if isinstance(exc, RuntimeError) and "event loop is closed" in str(exc).lower():
600 | |         return True
601 | |
602 | |     # Default to not cycling for unknown errors
603 | |     return False
    | |________________^
604 |
605 |       def _should_cycle(exc: Exception) -> bool:
    |
help: Inline condition

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/agents/writer.py:703:17
    |
701 |                 )
702 |                 _KEY_ROTATION_INDEX = (current_key_idx + 1) % num_keys if num_keys > 0 else 0
703 |                 return result
    |                 ^^^^^^^^^^^^^
704 |             except PromptTooLargeError:
705 |                 raise
    |

SIM102 Use a single `if` statement instead of nested `if` statements
   --> src/egregora/agents/writer.py:715:21
    |
713 |                   )
714 |                   if _should_cycle(exc):
715 | /                     if isinstance(exc, ModelHTTPError) and "openrouter" in model_name:
716 | |                         if affordable := _get_openrouter_affordable_tokens(exc):
717 | |                             if openrouter_max_tokens is None or affordable < openrouter_max_tokens:
    | |___________________________________________________________________________________________________^
718 |                                   openrouter_max_tokens = affordable
719 |                                   logger.warning("[WriterRotation] Retrying with affordable token limit: %d", affordable)
    |
help: Combine `if` statements using `and`

SIM102 Use a single `if` statement instead of nested `if` statements
   --> src/egregora/agents/writer.py:716:25
    |
714 |                   if _should_cycle(exc):
715 |                       if isinstance(exc, ModelHTTPError) and "openrouter" in model_name:
716 | /                         if affordable := _get_openrouter_affordable_tokens(exc):
717 | |                             if openrouter_max_tokens is None or affordable < openrouter_max_tokens:
    | |___________________________________________________________________________________________________^
718 |                                   openrouter_max_tokens = affordable
719 |                                   logger.warning("[WriterRotation] Retrying with affordable token limit: %d", affordable)
    |
help: Combine `if` statements using `and`

F821 Undefined name `_get_openrouter_affordable_tokens`
   --> src/egregora/agents/writer.py:716:42
    |
714 |                 if _should_cycle(exc):
715 |                     if isinstance(exc, ModelHTTPError) and "openrouter" in model_name:
716 |                         if affordable := _get_openrouter_affordable_tokens(exc):
    |                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
717 |                             if openrouter_max_tokens is None or affordable < openrouter_max_tokens:
718 |                                 openrouter_max_tokens = affordable
    |

BLE001 Do not catch blind exception: `Exception`
   --> src/egregora/agents/writer_helpers.py:366:16
    |
364 |         try:
365 |             return asyncio.run(model.count_tokens(prompt))
366 |         except Exception:
    |                ^^^^^^^^^
367 |             logger.debug("Native token counting failed, falling back to estimation")
    |

TRY301 Abstract `raise` to an inner function
   --> src/egregora/cli/diagnostics.py:206:13
    |
204 |         if not git_path:
205 |             msg = "git executable not found"
206 |             raise FileNotFoundError(msg)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
207 |
208 |         result = subprocess.run(
    |

ERA001 Found commented-out code
  --> src/egregora/cli/main.py:24:1
   |
22 | from egregora.cli.diagnostics import HealthStatus, run_diagnostics
23 |
24 | # from egregora.cli.db import db_app  # Removed - db.py no longer exists
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
25 | from egregora.cli.read import read_app
26 | from egregora.config import load_egregora_config
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> src/egregora/cli/main.py:44:1
   |
43 | # Database subcommands
44 | # app.add_typer(db_app)  # Removed - db.py no longer exists
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
45 |
46 | # Show subcommands
   |
help: Remove commented-out code

ERA001 Found commented-out code
   --> src/egregora/data_primitives/document.py:117:5
    |
115 |     type: DocumentType
116 |
117 |     # Metadata (format-agnostic)
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
118 |     metadata: dict[str, Any] = field(default_factory=dict)
    |
help: Remove commented-out code

SIM102 Use a single `if` statement instead of nested `if` statements
   --> src/egregora/data_primitives/document.py:166:9
    |
164 |           # 2. Semantic Identity (Slug)
165 |           # Only for Posts and Media, as per Pure spec
166 | /         if self.type in (DocumentType.POST, DocumentType.MEDIA):
167 | |             # Do NOT call self.slug property here to avoid recursion fallback loop
168 | |             if cleaned_slug := self._clean_slug(self.metadata.get("slug")):
    | |___________________________________________________________________________^
169 |                   return cleaned_slug
    |
help: Combine `if` statements using `and`

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/database/duckdb_manager.py:246:21
    |
244 |                     Path(db_str).unlink(missing_ok=True)
245 |                     _connect()
246 |                     return
    |                     ^^^^^^
247 |                 except (OSError, duckdb.Error):
248 |                     logger.exception("Failed to recover via file deletion")
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/database/duckdb_manager.py:677:86
    |
675 |                     values = _fetch_values()
676 |                 except duckdb.Error as retry_exc:
677 |                     logger.exception("Retry after connection reset also failed: %s", retry_exc)
    |                                                                                      ^^^^^^^^^
678 |                     raise SequenceRetryFailedError(sequence_name) from retry_exc
    |

G004 Logging statement uses f-string
  --> src/egregora/database/migrations.py:62:17
   |
61 |     create_sql = _build_create_table_sql(temp_table_name)
62 |     logger.info(f"Creating temporary table: {temp_table_name}")
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
63 |     conn.execute(create_sql)
   |
help: Convert to lazy `%` formatting

G004 Logging statement uses f-string
  --> src/egregora/database/migrations.py:66:17
   |
65 |     insert_sql = _build_insert_select_sql(temp_table_name, existing_columns)
66 |     logger.info(f"Copying data to temporary table: {temp_table_name}")
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
67 |     conn.execute(insert_sql)
   |
help: Convert to lazy `%` formatting

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/database/profile_cache.py:200:9
    |
199 |         logger.debug("Retrieved %d profiles from database", len(profiles))
200 |         return profiles
    |         ^^^^^^^^^^^^^^^
201 |     except Exception as e:
202 |         logger.warning("Failed to read profiles from DB: %s", e)
    |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/database/profile_cache.py:232:9
    |
231 |         logger.debug("Found %d opted-out authors in database", len(opted_out))
232 |         return opted_out
    |         ^^^^^^^^^^^^^^^^
233 |     except Exception as e:
234 |         logger.warning("Failed to read opted-out authors from DB: %s", e)
    |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/database/profile_cache.py:388:9
    |
387 |         logger.debug("Retrieved %d profile posts for %s from database", len(posts), author_uuid)
388 |         return posts
    |         ^^^^^^^^^^^^
389 |     except Exception as e:
390 |         logger.warning("Failed to read profile posts from DB for %s: %s", author_uuid, e)
    |

ERA001 Found commented-out code
  --> src/egregora/database/repository.py:47:21
   |
45 |                     "date": doc.internal_metadata.get("date"),
46 |                     "summary": doc.summary,
47 |                     # "authors": [str(a.id) for a in doc.authors],
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
48 |                     # "tags": [c.term for c in doc.categories],
49 |                     "status": doc.status,
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> src/egregora/database/repository.py:48:21
   |
46 |                     "summary": doc.summary,
47 |                     # "authors": [str(a.id) for a in doc.authors],
48 |                     # "tags": [c.term for c in doc.categories],
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
49 |                     "status": doc.status,
50 |                 }
   |
help: Remove commented-out code

ERA001 Found commented-out code
   --> src/egregora/database/repository.py:182:9
    |
180 |         # if row.get("authors"):
181 |         #     # Assuming row['authors'] is list of strings (UUIDs)
182 |         #     authors = [Author(id=uid, name="") for uid in row["authors"]]
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
183 |
184 |         # if row.get("tags"):
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> src/egregora/database/repository.py:185:9
    |
184 |         # if row.get("tags"):
185 |         #     categories = [Category(term=tag) for tag in row["tags"]]
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
186 |
187 |         return Document(
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> src/egregora/database/repository.py:193:13
    |
191 |             updated=row.get("created_at"),  # Map created_at back to updated?
192 |             summary=row.get("summary"),
193 |             # authors=authors,
    |             ^^^^^^^^^^^^^^^^^^
194 |             # categories=categories,
195 |             doc_type=doc_type,
    |
help: Remove commented-out code

ERA001 Found commented-out code
   --> src/egregora/database/repository.py:194:13
    |
192 |             summary=row.get("summary"),
193 |             # authors=authors,
194 |             # categories=categories,
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
195 |             doc_type=doc_type,
196 |             internal_metadata=internal_metadata,
    |
help: Remove commented-out code

G004 Logging statement uses f-string
  --> src/egregora/input_adapters/self_reflection.py:57:28
   |
55 |             documents.append(doc)
56 |         except (OSError, yaml.YAMLError) as e:
57 |             logger.warning(f"Failed to parse {md_file}: {e}")
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 |     return documents
   |
help: Convert to lazy `%` formatting

DTZ011 `datetime.date.today()` used
  --> src/egregora/input_adapters/self_reflection.py:83:17
   |
81 |     @property
82 |     def generation_instructions(self) -> str:
83 |         today = date.today().isoformat()
   |                 ^^^^^^^^^^^^
84 |         return (
85 |             "You are reviewing posts that you already wrote. Only create a new post when you can "
   |
help: Use `datetime.datetime.now(tz=...).date()` instead

TRY301 Abstract `raise` to an inner function
   --> src/egregora/input_adapters/whatsapp/adapter.py:99:17
    |
 97 |             if not input_path.exists():
 98 |                 msg = f"Input path does not exist: {input_path}"
 99 |                 raise FileNotFoundError(msg)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
100 |             if not input_path.is_file() or not str(input_path).endswith(".zip"):
101 |                 msg = f"Expected a ZIP file, got: {input_path}"
    |

TRY301 Abstract `raise` to an inner function
   --> src/egregora/input_adapters/whatsapp/adapter.py:102:17
    |
100 |             if not input_path.is_file() or not str(input_path).endswith(".zip"):
101 |                 msg = f"Expected a ZIP file, got: {input_path}"
102 |                 raise ValueError(msg)
    |                 ^^^^^^^^^^^^^^^^^^^^^
103 |
104 |             group_name, chat_file = discover_chat_file(input_path)
    |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/input_adapters/whatsapp/adapter.py:121:13
    |
120 |             logger.debug("Parsed WhatsApp export with %s messages", messages_table.count().execute())
121 |             return messages_table
    |             ^^^^^^^^^^^^^^^^^^^^^
122 |         except (FileNotFoundError, ValueError) as e:
123 |             logger.exception("Validation failed for input path %s: %s", input_path, e)
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/input_adapters/whatsapp/adapter.py:123:85
    |
121 |             return messages_table
122 |         except (FileNotFoundError, ValueError) as e:
123 |             logger.exception("Validation failed for input path %s: %s", input_path, e)
    |                                                                                     ^
124 |             msg = f"Invalid input path: {input_path}"
125 |             raise WhatsAppAdapterError(msg) from e
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/input_adapters/whatsapp/adapter.py:127:81
    |
125 |             raise WhatsAppAdapterError(msg) from e
126 |         except zipfile.BadZipFile as e:
127 |             logger.exception("Invalid ZIP file provided at %s: %s", input_path, e)
    |                                                                                 ^
128 |             raise InvalidZipFileError(str(input_path)) from e
129 |         except WhatsAppParsingError as e:
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/input_adapters/whatsapp/adapter.py:130:87
    |
128 |             raise InvalidZipFileError(str(input_path)) from e
129 |         except WhatsAppParsingError as e:
130 |             logger.exception("Failed to parse WhatsApp export at %s: %s", input_path, e)
    |                                                                                       ^
131 |             msg = f"Failed to parse WhatsApp export: {e}"
132 |             raise WhatsAppAdapterError(msg) from e
    |

DTZ007 Naive datetime constructed using `datetime.datetime.strptime()` without %z
   --> src/egregora/input_adapters/whatsapp/parsing.py:155:20
    |
153 |     for fmt in _DATE_FORMATS:
154 |         try:
155 |             return datetime.strptime(normalized, fmt).date()
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
156 |         except ValueError:
157 |             continue
    |
help: Call `.replace(tzinfo=<timezone>)` or `.astimezone()` to convert to an aware datetime

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/knowledge/profiles.py:379:9
    |
377 |         profile_path = _find_profile_path(author_uuid, profiles_dir)
378 |         content = profile_path.read_text(encoding="utf-8")
379 |         return profile_path, content
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
380 |     except ProfileNotFoundError:
381 |         front_matter = {"uuid": author_uuid, "subject": author_uuid}
    |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/knowledge/profiles.py:532:9
    |
530 |     try:
531 |         profile_content = read_profile(author_uuid, profiles_dir)
532 |         return "Status: OPTED OUT" in profile_content
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
533 |     except ProfileNotFoundError:
534 |         # If a profile doesn't exist, the user cannot have opted out.
    |

DTZ006 `datetime.datetime.fromtimestamp()` called without a `tz` argument
   --> src/egregora/knowledge/profiles.py:900:17
    |
899 |     try:
900 |         mtime = datetime.fromtimestamp(path.stat().st_mtime)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
901 |         return mtime.date()
902 |     except OSError:
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/llm/providers/model_cycler.py:145:17
    |
143 |                 self.next_key()
144 |
145 |                 return result
    |                 ^^^^^^^^^^^^^
146 |             except Exception as exc:
147 |                 # Always rotate on error too
    |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/llm/providers/model_cycler.py:267:17
    |
265 |                 # Success - reset for next call
266 |                 self.reset()
267 |                 return result
    |                 ^^^^^^^^^^^^^
268 |             except Exception as exc:
269 |                 if is_rate_limit_error(exc):
    |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/llm/providers/model_key_rotator.py:137:17
    |
135 |                 result = call_fn(model, api_key)
136 |                 self.reset()
137 |                 return result
    |                 ^^^^^^^^^^^^^
138 |             except Exception as exc:
139 |                 last_exception = exc
    |

BLE001 Do not catch blind exception: `Exception`
   --> src/egregora/ops/taxonomy.py:141:16
    |
139 |             result = agent.run_sync(prompt)
140 |             batch_results.append(result.data.mappings)
141 |         except Exception as e:
    |                ^^^^^^^^^
142 |             logger.warning("Batch taxonomy generation failed: %s", e)
143 |             batch_results.append([])
    |

ERA001 Found commented-out code
   --> src/egregora/orchestration/context.py:140:5
    |
138 |     cache: PipelineCache
139 |
140 |     # Stores (Optional)
    |     ^^^^^^^^^^^^^^^^^^^
141 |     annotations_store: AnnotationStore | None = None
142 |     task_store: TaskStore | None = None
    |
help: Remove commented-out code

TRY300 Consider moving this statement to an `else` block
  --> src/egregora/orchestration/journal.py:41:9
   |
39 |                 logger.debug("Found existing JOURNAL for signature: %s", signature[:12])
40 |                 return True
41 |         return False
   |         ^^^^^^^^^^^^
42 |     except Exception as e:
43 |         logger.warning("Error checking for existing JOURNAL: %s. Assuming not processed.", e)
   |

TRY300 Consider moving this statement to an `else` block
   --> src/egregora/orchestration/pipelines/write.py:177:13
    |
175 |                 os.environ["GOOGLE_API_KEY"] = key
176 |             console.print("[green]âœ“ API key validated successfully[/green]")
177 |             return
    |             ^^^^^^
178 |         except ValueError as e:
179 |             validation_errors.append(str(e))
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/pipelines/write.py:673:72
    |
671 |                     output_sink.persist(media_doc)
672 |                 except Exception as e:
673 |                     logger.exception("Failed to write media file: %s", e)
    |                                                                        ^
674 |
675 |         # ETL Step 2: Enrichment
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/pipelines/write.py:732:73
    |
730 |                 announcements_generated += 1
731 |             except Exception as exc:
732 |                 logger.exception("Failed to generate announcement: %s", exc)
    |                                                                         ^^^
733 |
734 |     clean_messages_list = filter_commands(messages_list)
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/pipelines/write.py:782:64
    |
780 |                 output_sink.persist(post)
781 |             except Exception as exc:
782 |                 logger.exception("Failed to persist post: %s", exc)
    |                                                                ^^^
783 |
784 |     # EXECUTE PROFILE GENERATOR
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/pipelines/write.py:793:67
    |
791 |                 profiles.append(profile_doc.document_id)
792 |             except Exception as exc:
793 |                 logger.exception("Failed to persist profile: %s", exc)
    |                                                                   ^^^
794 |     except Exception as exc:
795 |         logger.exception("Failed to generate profile posts: %s", exc)
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/pipelines/write.py:795:66
    |
793 |                 logger.exception("Failed to persist profile: %s", exc)
794 |     except Exception as exc:
795 |         logger.exception("Failed to generate profile posts: %s", exc)
    |                                                                  ^^^
796 |
797 |     # Process background tasks (Banner, etc)
    |

ERA001 Found commented-out code
    --> src/egregora/orchestration/pipelines/write.py:1237:5
     |
1236 |     # Media RAG indexing removed - will be reimplemented with egregora.rag
1237 |     # logger.info("[bold cyan]ðŸ“š Indexing media into RAG...[/]")
     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1238 |     # ... (removed for now)
     |
help: Remove commented-out code

ERA001 Found commented-out code
   --> src/egregora/orchestration/runner.py:190:17
    |
189 |             for journal in journals:
190 |                 # journal is DocumentMetadata (identifier, doc_type, metadata)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
191 |                 meta = journal.metadata
192 |                 if not meta:
    |
help: Remove commented-out code

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/runner.py:317:72
    |
315 |                     output_sink.persist(media_doc)
316 |                 except Exception as e:
317 |                     logger.exception("Failed to write media file: %s", e)
    |                                                                        ^
318 |
319 |         if self.context.enable_enrichment:
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/runner.py:376:77
    |
374 |                     announcements_generated += 1
375 |                 except Exception as exc:
376 |                     logger.exception("Failed to generate announcement: %s", exc)
    |                                                                             ^^^
377 |
378 |         clean_messages_list = filter_commands(messages_list)
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/runner.py:406:71
    |
404 |                     profiles.append(profile_doc.document_id)
405 |                 except Exception as exc:
406 |                     logger.exception("Failed to persist profile: %s", exc)
    |                                                                       ^^^
407 |         except Exception as exc:
408 |             logger.exception("Failed to generate profile posts: %s", exc)
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/runner.py:408:70
    |
406 |                     logger.exception("Failed to persist profile: %s", exc)
407 |         except Exception as exc:
408 |             logger.exception("Failed to generate profile posts: %s", exc)
    |                                                                      ^^^
409 |
410 |         # Scheduled tasks are returned as "pending:<task_id>"
    |

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/orchestration/runner.py:518:77
    |
516 |                     announcements_generated += 1
517 |                 except Exception as exc:
518 |                     logger.exception("Failed to generate announcement: %s", exc)
    |                                                                             ^^^
519 |         return announcements_generated
    |

DTZ011 `datetime.date.today()` used
   --> src/egregora/output_adapters/base.py:193:20
    |
191 |         """Extract clean YYYY-MM-DD date from various formats."""
192 |         if not date_str:
193 |             return datetime.date.today().isoformat()
    |                    ^^^^^^^^^^^^^^^^^^^^^
194 |
195 |         date_str = date_str.strip()
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

DTZ011 `datetime.date.today()` used
   --> src/egregora/output_adapters/base.py:218:16
    |
217 |         # Fallback: use today's date
218 |         return datetime.date.today().isoformat()
    |                ^^^^^^^^^^^^^^^^^^^^^
219 |
220 |     @staticmethod
    |
help: Use `datetime.datetime.now(tz=...).date()` instead

ERA001 Found commented-out code
   --> src/egregora/output_adapters/mkdocs/adapter.py:284:17
    |
282 |         match doc_type:
283 |             case DocumentType.PROFILE:
284 |                 # Profiles: "author_uuid/slug" (preferred) or "author_uuid" (latest)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
285 |                 if "/" in identifier:
286 |                     author_uuid, slug = identifier.split("/", 1)
    |
help: Remove commented-out code

TRY401 Redundant exception object included in `logging.exception` call
   --> src/egregora/rag/lancedb_backend.py:313:64
    |
311 |             return len(document_ids)
312 |         except Exception as e:
313 |             logger.exception("Failed to delete documents: %s", e)
    |                                                                ^
314 |             msg = f"Delete failed: {e}"
315 |             raise RuntimeError(msg) from e
    |

SIM108 Use ternary operator `delta = timedelta(hours=step_size) if step_unit == "hours" else timedelta(days=step_size)` instead of `if`-`else`-block
   --> src/egregora/transformations/windowing.py:337:5
    |
336 |       # Calculate window duration
337 | /     if step_unit == "hours":
338 | |         delta = timedelta(hours=step_size)
339 | |     else:  # days
340 | |         delta = timedelta(days=step_size)
    | |_________________________________________^
341 |
342 |       # Calculate overlap duration
    |
help: Replace `if`-`else`-block with `delta = timedelta(hours=step_size) if step_unit == "hours" else timedelta(days=step_size)`

TRY002 Create your own exception
  --> tests/step_defs/test_model_key_rotation.py:56:19
   |
54 |         if context["call_count"] <= 8:
55 |             msg = "429 Too Many Requests"
56 |             raise Exception(msg)
   |                   ^^^^^^^^^^^^^^
57 |
58 |         return f"Success with {model} and {api_key}"
   |

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/agents/test_avatar.py:35:23
   |
33 |             value="http://example.com/avatar.jpg",
34 |             author_uuid="author1",
35 |             timestamp=datetime.now(),
   |                       ^^^^^^^^^^^^^^
36 |             context=context,
37 |         )
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/agents/test_avatar.py:57:23
   |
55 |         result = _process_set_avatar_command(
56 |             author_uuid="author1",
57 |             timestamp=datetime.now(),
   |                       ^^^^^^^^^^^^^^
58 |             context=context,
59 |             value="http://example.com/new_avatar.jpg",
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/agents/test_writer_logic.py:58:92
   |
57 |         # We need at least one entry for save to happen
58 |         entry = writer_module.JournalEntry(entry_type="journal", content="test", timestamp=datetime.now())
   |                                                                                            ^^^^^^^^^^^^^^
59 |
60 |         params = writer_module.WriterJournalEntryParams(
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/agents/test_writer_logic.py:66:26
   |
64 |             posts_published=0,
65 |             profiles_updated=0,
66 |             window_start=datetime.now(),
   |                          ^^^^^^^^^^^^^^
67 |             window_end=datetime.now(),
68 |         )
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/agents/test_writer_logic.py:67:24
   |
65 |             profiles_updated=0,
66 |             window_start=datetime.now(),
67 |             window_end=datetime.now(),
   |                        ^^^^^^^^^^^^^^
68 |         )
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/agents/test_writer_logic.py:91:77
   |
90 |         params = writer_module.WriterJournalEntryParams(
91 |             intercalated_log=[writer_module.JournalEntry("journal", "test", datetime.now())],
   |                                                                             ^^^^^^^^^^^^^^
92 |             window_label="test-window",
93 |             output_sink=MagicMock(),
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/agents/test_writer_logic.py:96:26
   |
94 |             posts_published=0,
95 |             profiles_updated=0,
96 |             window_start=datetime.now(),
   |                          ^^^^^^^^^^^^^^
97 |             window_end=datetime.now(),
98 |         )
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/agents/test_writer_logic.py:97:24
   |
95 |             profiles_updated=0,
96 |             window_start=datetime.now(),
97 |             window_end=datetime.now(),
   |                        ^^^^^^^^^^^^^^
98 |         )
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> tests/unit/agents/test_writer_logic.py:120:77
    |
119 |         params = writer_module.WriterJournalEntryParams(
120 |             intercalated_log=[writer_module.JournalEntry("journal", "test", datetime.now())],
    |                                                                             ^^^^^^^^^^^^^^
121 |             window_label="test-window",
122 |             output_sink=mock_output,
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> tests/unit/agents/test_writer_logic.py:125:26
    |
123 |             posts_published=0,
124 |             profiles_updated=0,
125 |             window_start=datetime.now(),
    |                          ^^^^^^^^^^^^^^
126 |             window_end=datetime.now(),
127 |         )
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> tests/unit/agents/test_writer_logic.py:126:24
    |
124 |             profiles_updated=0,
125 |             window_start=datetime.now(),
126 |             window_end=datetime.now(),
    |                        ^^^^^^^^^^^^^^
127 |         )
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> tests/unit/agents/test_writer_logic.py:183:22
    |
181 |     params = writer_module.WindowProcessingParams(
182 |         table=mock_table,
183 |         window_start=datetime.now(),
    |                      ^^^^^^^^^^^^^^
184 |         window_end=datetime.now(),
185 |         resources=MagicMock(),
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> tests/unit/agents/test_writer_logic.py:184:20
    |
182 |         table=mock_table,
183 |         window_start=datetime.now(),
184 |         window_end=datetime.now(),
    |                    ^^^^^^^^^^^^^^
185 |         resources=MagicMock(),
186 |         config=test_config,
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> tests/unit/agents/test_writer_logic.py:258:12
    |
256 |     mock_message = Message(
257 |         event_id="test-id",
258 |         ts=datetime.now(),
    |            ^^^^^^^^^^^^^^
259 |         author_uuid="test-author",
260 |         text="test content",
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> tests/unit/agents/test_writer_logic.py:267:22
    |
265 |     params = writer_module.WindowProcessingParams(
266 |         table=mock_table,
267 |         window_start=datetime.now(),
    |                      ^^^^^^^^^^^^^^
268 |         window_end=datetime.now(),
269 |         resources=mock_resources,
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ005 `datetime.datetime.now()` called without a `tz` argument
   --> tests/unit/agents/test_writer_logic.py:268:20
    |
266 |         table=mock_table,
267 |         window_start=datetime.now(),
268 |         window_end=datetime.now(),
    |                    ^^^^^^^^^^^^^^
269 |         resources=mock_resources,
270 |         config=test_config,
    |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/common/test_datetime_utils.py:20:22
   |
18 |     "iso_datetime_zulu": ("2025-01-01T12:00:00Z", datetime(2025, 1, 1, 12, 0, 0, tzinfo=UTC)),
19 |     "human_date": ("Jan 1, 2025", datetime(2025, 1, 1, tzinfo=UTC)),
20 |     "datetime_obj": (datetime(2025, 1, 1, 12, 0, 0), datetime(2025, 1, 1, 12, 0, 0, tzinfo=UTC)),
   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
21 |     "date_obj": (date(2025, 1, 1), datetime(2025, 1, 1, tzinfo=UTC)),
22 |     "time_only": (
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

ERA001 Found commented-out code
  --> tests/unit/dev_tools/test_check_private_imports.py:8:1
   |
 6 | # Add scripts/dev_tools to path
 7 | # We are in tests/unit/dev_tools/test_check_private_imports.py
 8 | # parents[0] = dev_tools
   | ^^^^^^^^^^^^^^^^^^^^^^^^
 9 | # parents[1] = unit
10 | # parents[2] = tests
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> tests/unit/dev_tools/test_check_private_imports.py:9:1
   |
 7 | # We are in tests/unit/dev_tools/test_check_private_imports.py
 8 | # parents[0] = dev_tools
 9 | # parents[1] = unit
   | ^^^^^^^^^^^^^^^^^^^
10 | # parents[2] = tests
11 | # parents[3] = root
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> tests/unit/dev_tools/test_check_private_imports.py:10:1
   |
 8 | # parents[0] = dev_tools
 9 | # parents[1] = unit
10 | # parents[2] = tests
   | ^^^^^^^^^^^^^^^^^^^^
11 | # parents[3] = root
12 | sys.path.insert(0, str(Path(__file__).parents[3] / "scripts" / "dev_tools"))
   |
help: Remove commented-out code

ERA001 Found commented-out code
  --> tests/unit/dev_tools/test_check_private_imports.py:11:1
   |
 9 | # parents[1] = unit
10 | # parents[2] = tests
11 | # parents[3] = root
   | ^^^^^^^^^^^^^^^^^^^
12 | sys.path.insert(0, str(Path(__file__).parents[3] / "scripts" / "dev_tools"))
   |
help: Remove commented-out code

PT012 `pytest.raises()` block should contain a single simple statement
  --> tests/unit/knowledge/test_profiles_exceptions.py:19:5
   |
17 |       """Test that ProfileNotFoundError sets author_uuid correctly."""
18 |       author_uuid = "test-uuid"
19 | /     with pytest.raises(ProfileNotFoundError) as excinfo:
20 | |         msg = "Profile not found"
21 | |         raise ProfileNotFoundError(msg, author_uuid=author_uuid)
   | |________________________________________________________________^
22 |       assert excinfo.value.author_uuid == author_uuid
23 |       assert excinfo.value.path is None
   |

PT012 `pytest.raises()` block should contain a single simple statement
  --> tests/unit/knowledge/test_profiles_exceptions.py:29:5
   |
27 |       """Test that ProfileNotFoundError sets path correctly."""
28 |       path = "/test/path"
29 | /     with pytest.raises(ProfileNotFoundError) as excinfo:
30 | |         msg = "Profile not found"
31 | |         raise ProfileNotFoundError(msg, path=path)
   | |__________________________________________________^
32 |       assert excinfo.value.path == path
33 |       assert excinfo.value.author_uuid is None
   |

PT012 `pytest.raises()` block should contain a single simple statement
  --> tests/unit/knowledge/test_profiles_exceptions.py:39:5
   |
37 |       """Test that ProfileParseError sets path correctly."""
38 |       path = "/test/path"
39 | /     with pytest.raises(ProfileParseError) as excinfo:
40 | |         msg = "Parse error"
41 | |         raise ProfileParseError(msg, path=path)
   | |_______________________________________________^
42 |       assert excinfo.value.path == path
   |

PT012 `pytest.raises()` block should contain a single simple statement
  --> tests/unit/knowledge/test_profiles_exceptions.py:48:5
   |
46 |       """Test that InvalidAliasError sets alias correctly."""
47 |       alias = "test-alias"
48 | /     with pytest.raises(InvalidAliasError) as excinfo:
49 | |         msg = "Invalid alias"
50 | |         raise InvalidAliasError(msg, alias=alias)
   | |_________________________________________________^
51 |       assert excinfo.value.alias == alias
   |

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/orchestration/test_factory.py:24:20
   |
22 |     return PipelineRunParams(
23 |         run_id="test-run",
24 |         start_time=datetime.now(),
   |                    ^^^^^^^^^^^^^^
25 |         source_type="test",
26 |         config=config,
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner.py:41:25
   |
39 |     window.size = 10
40 |     # Use real datetime objects to avoid formatting issues
41 |     window.start_time = datetime(2023, 1, 1, 10, 0)
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
42 |     window.end_time = datetime(2023, 1, 2, 10, 0)
43 |     window.window_index = 0
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner.py:42:23
   |
40 |     # Use real datetime objects to avoid formatting issues
41 |     window.start_time = datetime(2023, 1, 1, 10, 0)
42 |     window.end_time = datetime(2023, 1, 2, 10, 0)
   |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
43 |     window.window_index = 0
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner.py:56:22
   |
54 |     results, max_ts = runner.process_windows(windows_iterator)
55 |     assert results == {"test_window": {"posts": ["post1"]}}
56 |     assert max_ts == datetime(2023, 1, 2, 10, 0)
   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |
58 |     runner.process_background_tasks.assert_called()
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner.py:88:25
   |
87 |     window = MagicMock()
88 |     window.start_time = datetime(2023, 1, 1)
   |                         ^^^^^^^^^^^^^^^^^^^^
89 |     window.end_time = datetime(2023, 1, 1, 1)
90 |     window.table = MagicMock()
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner.py:89:23
   |
87 |     window = MagicMock()
88 |     window.start_time = datetime(2023, 1, 1)
89 |     window.end_time = datetime(2023, 1, 1, 1)
   |                       ^^^^^^^^^^^^^^^^^^^^^^^
90 |     window.table = MagicMock()
91 |     window.size = 10
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
   --> tests/unit/orchestration/test_runner.py:157:36
    |
155 |     # Mock the split function to return a dummy window to continue the loop
156 |     mock_split_window = MagicMock()
157 |     mock_split_window.start_time = datetime(2023, 1, 1, 12, 0)
    |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
158 |     mock_split_window.end_time = datetime(2023, 1, 1, 13, 0)
159 |     mock_split_window.size = 5  # Needs to be greater than or equal to min_window_size in the code
    |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
   --> tests/unit/orchestration/test_runner.py:158:34
    |
156 |     mock_split_window = MagicMock()
157 |     mock_split_window.start_time = datetime(2023, 1, 1, 12, 0)
158 |     mock_split_window.end_time = datetime(2023, 1, 1, 13, 0)
    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
159 |     mock_split_window.size = 5  # Needs to be greater than or equal to min_window_size in the code
160 |     monkeypatch.setattr(
    |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
   --> tests/unit/orchestration/test_runner.py:165:30
    |
164 |     mock_window = MagicMock()
165 |     mock_window.start_time = datetime(2023, 1, 1, 12, 0)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
166 |     mock_window.end_time = datetime(2023, 1, 1, 13, 0)
167 |     mock_window.size = 10
    |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
   --> tests/unit/orchestration/test_runner.py:166:28
    |
164 |     mock_window = MagicMock()
165 |     mock_window.start_time = datetime(2023, 1, 1, 12, 0)
166 |     mock_window.end_time = datetime(2023, 1, 1, 13, 0)
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
167 |     mock_window.size = 10
    |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
   --> tests/unit/orchestration/test_runner.py:183:30
    |
182 |     mock_window = MagicMock()
183 |     mock_window.start_time = datetime(2023, 1, 1, 12, 0)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
184 |     mock_window.end_time = datetime(2023, 1, 1, 13, 0)
185 |     mock_window.size = 10
    |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
   --> tests/unit/orchestration/test_runner.py:184:28
    |
182 |     mock_window = MagicMock()
183 |     mock_window.start_time = datetime(2023, 1, 1, 12, 0)
184 |     mock_window.end_time = datetime(2023, 1, 1, 13, 0)
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
185 |     mock_window.size = 10
    |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner_journal.py:52:26
   |
50 |     # Window 1: Matches journal -> Should be skipped
51 |     window1 = MagicMock()
52 |     window1.start_time = datetime(2023, 1, 1, 10, 0, 0)
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
53 |     window1.end_time = datetime(2023, 1, 1, 12, 0, 0)
54 |     window1.window_index = 0
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner_journal.py:53:24
   |
51 |     window1 = MagicMock()
52 |     window1.start_time = datetime(2023, 1, 1, 10, 0, 0)
53 |     window1.end_time = datetime(2023, 1, 1, 12, 0, 0)
   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
54 |     window1.window_index = 0
55 |     window1.size = 10
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner_journal.py:59:26
   |
57 |     # Window 2: New -> Should be processed
58 |     window2 = MagicMock()
59 |     window2.start_time = datetime(2023, 1, 1, 12, 0, 0)
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
60 |     window2.end_time = datetime(2023, 1, 1, 14, 0, 0)
61 |     window2.window_index = 1
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/orchestration/test_runner_journal.py:60:24
   |
58 |     window2 = MagicMock()
59 |     window2.start_time = datetime(2023, 1, 1, 12, 0, 0)
60 |     window2.end_time = datetime(2023, 1, 1, 14, 0, 0)
   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |     window2.window_index = 1
62 |     window2.size = 10
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

TRY002 Create your own exception
   --> tests/unit/orchestration/test_runner_journal_integration.py:170:23
    |
168 |             if doc == mock_journal_doc:
169 |                 msg = "DB Error"
170 |                 raise Exception(msg)
    |                       ^^^^^^^^^^^^^^
171 |
172 |         mock_context.output_sink.persist.side_effect = persist_side_effect
    |

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/output_adapters/mkdocs/test_markdown_utils.py:19:31
   |
17 | # region: Tests for extract_clean_date
18 | def test_extract_clean_date_with_datetime():
19 |     assert extract_clean_date(datetime(2023, 1, 1, 12, 30)) == "2023-01-01"
   |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/output_adapters/mkdocs/test_markdown_utils.py:60:6
   |
58 |     ("2023-01-15", "2023-01-15"),
59 |     (date(2023, 1, 15), "2023-01-15"),
60 |     (datetime(2023, 1, 15, 10, 30), "2023-01-15"),
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |     ("  2023-01-15T10:30:00Z  ", "2023-01-15"),
62 |     ("Some text surrounding 2023-01-15 and other things", "2023-01-15"),
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

PT012 `pytest.raises()` block should contain a single simple statement
  --> tests/unit/rag/test_exceptions.py:37:9
   |
35 |       def test_can_be_raised_and_caught(self):
36 |           """EmbeddingError can be raised and caught."""
37 | /         with pytest.raises(EmbeddingError) as exc_info:
38 | |             msg = "Embedding failed"
39 | |             raise EmbeddingError(msg)
   | |_____________________________________^
40 |           assert "Embedding failed" in str(exc_info.value)
   |

PT012 `pytest.raises()` block should contain a single simple statement
   --> tests/unit/rag/test_exceptions.py:101:9
    |
 99 |       def test_can_be_caught_as_embedding_error(self):
100 |           """Validation errors can be caught as EmbeddingError."""
101 | /         with pytest.raises(EmbeddingError):
102 | |             msg = "Invalid response format"
103 | |             raise EmbeddingValidationError(msg)
    | |_______________________________________________^
    |

DTZ005 `datetime.datetime.now()` called without a `tz` argument
  --> tests/unit/rag/test_vectorized_rag.py:33:27
   |
31 |         self.slug = f"mock-slug-{document_id}"
32 |         self.suggested_path = f"posts/{self.slug}.md"
33 |         self.created_at = datetime.now()
   |                           ^^^^^^^^^^^^^^
34 |         self.source_window = "test_window"
35 |         self.metadata = {}
   |
help: Pass a `datetime.timezone` object to the `tz` parameter

ERA001 Found commented-out code
  --> tests/unit/test_media_slugs.py:82:5
   |
81 |     # 2. suggested_path should include the subfolder and slug-based name
82 |     # DESIRED: media/images/cool-new-slug.jpg
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
83 |     # CURRENT: None (or some default if not set)
84 |     assert media_doc.suggested_path == "media/images/cool-new-slug.jpg"
   |
help: Remove commented-out code

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
  --> tests/unit/transformations/test_windowing.py:21:22
   |
19 | def create_test_table(messages=100, start_time=None):
20 |     if start_time is None:
21 |         start_time = datetime(2023, 1, 1, 10, 0, 0)
   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |
23 |     if isinstance(messages, int):
   |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
   --> tests/unit/transformations/test_windowing.py:102:13
    |
101 |     # Messages are 1 min apart starting at 10:00:00
102 |     start = datetime(2023, 1, 1, 10, 0, 0)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
103 |     assert w0_min == start
104 |     assert w1_min == start + timedelta(minutes=50)
    |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

DTZ001 `datetime.datetime()` called without a `tzinfo` argument
   --> tests/unit/transformations/test_windowing.py:260:18
    |
258 |     """Test that max_window_time constrains the window size."""
259 |     # 3 days of data (72 hours)
260 |     start_time = datetime(2023, 1, 1, 0, 0, 0)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
261 |     # One message per hour for 72 hours
262 |     data = [{"ts": start_time + timedelta(hours=i), "text": f"msg {i}", "sender": "A"} for i in range(72)]
    |
help: Pass a `datetime.timezone` object to the `tzinfo` parameter

Found 131 errors.
