{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "IR v1 Schema",
  "description": "Canonical Ibis schema for Intermediate Representation v1",
  "version": "1.0.0",
  "generated": "2025-01-08",
  "note": "When using ibis.schema(), all dtypes default to nullable=True",
  "columns": {
    "event_id": {
      "type": "String",
      "nullable": true,
      "description": "Unique event identifier"
    },
    "tenant_id": {
      "type": "String",
      "nullable": true,
      "description": "Namespace isolation for multiple data sources"
    },
    "source": {
      "type": "String",
      "nullable": true,
      "description": "Source adapter name (e.g., 'whatsapp', 'slack')"
    },
    "thread_id": {
      "type": "String",
      "nullable": true,
      "description": "Conversation thread identifier"
    },
    "msg_id": {
      "type": "String",
      "nullable": true,
      "description": "Message identifier within thread"
    },
    "ts": {
      "type": "Timestamp",
      "timezone": "UTC",
      "nullable": true,
      "description": "Message timestamp"
    },
    "author_raw": {
      "type": "String",
      "nullable": true,
      "description": "Original author name (PRIVACY BOUNDARY - anonymized before LLM)"
    },
    "author_uuid": {
      "type": "String",
      "nullable": true,
      "description": "Deterministic UUID mapping for privacy"
    },
    "text": {
      "type": "String",
      "nullable": true,
      "description": "Message text content"
    },
    "media_url": {
      "type": "String",
      "nullable": true,
      "description": "Media attachment URL or path"
    },
    "media_type": {
      "type": "String",
      "nullable": true,
      "description": "MIME type of media attachment"
    },
    "attrs": {
      "type": "JSON",
      "nullable": true,
      "description": "Source-specific attributes (flexible extension point)"
    },
    "pii_flags": {
      "type": "JSON",
      "nullable": true,
      "description": "PII detection results"
    },
    "created_at": {
      "type": "Timestamp",
      "timezone": "UTC",
      "nullable": true,
      "description": "Pipeline processing timestamp"
    },
    "created_by_run": {
      "type": "String",
      "nullable": true,
      "description": "Pipeline run ID for lineage tracking"
    }
  },
  "required_columns": [
    "event_id",
    "tenant_id",
    "source",
    "thread_id",
    "msg_id",
    "ts",
    "author_raw",
    "author_uuid",
    "created_at"
  ],
  "column_order": [
    "event_id",
    "tenant_id",
    "source",
    "thread_id",
    "msg_id",
    "ts",
    "author_raw",
    "author_uuid",
    "text",
    "media_url",
    "media_type",
    "attrs",
    "pii_flags",
    "created_at",
    "created_by_run"
  ]
}
