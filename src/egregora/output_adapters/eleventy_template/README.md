# Egregora Eleventy Template

This is an Eleventy site that consumes Arrow/Parquet data generated by Egregora's `EleventyArrowAdapter`.

## Architecture

```
output/
  data/                         # Parquet files (generated by Egregora)
    window_0.parquet
    window_1.parquet
    window_2.parquet
  eleventy/                     # Eleventy site (this template)
    src/
      _data/
        documents.js            # Reads Parquet files
      _includes/
        base.njk                # Base layout
      posts/
        post.njk                # Post template (paginated)
      index.njk                 # Homepage
    .eleventy.js                # Eleventy config
    package.json
```

## Setup

1. **Copy this template to your output directory:**
   ```bash
   cp -r src/egregora/output_adapters/eleventy_template output/eleventy
   cd output/eleventy
   ```

2. **Install dependencies:**
   ```bash
   npm install
   ```

3. **Generate Parquet data:**
   ```bash
   cd ../..  # Back to repo root
   uv run egregora write export.zip --output-format=eleventy-arrow
   ```

4. **Build site:**
   ```bash
   cd output/eleventy
   npm run build
   # Site generated in _site/
   ```

5. **Serve locally:**
   ```bash
   npm run serve
   # Visit http://localhost:8080
   ```

## How It Works

1. **Egregora writes Parquet:** `EleventyArrowAdapter` writes one Parquet file per window to `output/data/`

2. **Eleventy reads at build time:** `src/_data/documents.js` loads all Parquet files and exposes them as `{{ documents }}`

3. **Templates render:** Eleventy iterates over collections (posts, profiles) and generates HTML pages

4. **No markdown files:** Posts are stored as columnar data in Parquet, not individual `.md` files

## Customization

- **Styling:** Edit `src/_includes/base.njk` or add `src/assets/style.css`
- **Templates:** Add templates in `src/` (e.g., `profiles/profile.njk`)
- **Collections:** Define new collections in `.eleventy.js`
- **Data schema:** Parquet schema defined in `EleventyArrowAdapter._documents_to_arrow()`

## Deployment

Deploy the `_site/` directory to any static host:

```bash
# Netlify
netlify deploy --dir=_site --prod

# Vercel
vercel --prod _site

# GitHub Pages
npm run build
git add _site -f
git subtree push --prefix _site origin gh-pages
```

## Querying Parquet Files (Optional)

You can query Parquet files directly with DuckDB:

```bash
duckdb
```

```sql
SELECT kind, COUNT(*) as count
FROM read_parquet('output/data/window_*.parquet')
GROUP BY kind;

SELECT title, created_at
FROM read_parquet('output/data/window_*.parquet')
WHERE kind = 'post'
ORDER BY created_at DESC
LIMIT 10;
```
